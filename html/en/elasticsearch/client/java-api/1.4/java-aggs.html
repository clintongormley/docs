
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Aggregations</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Java API [1.4]" /><link rel="up" href="index.html" title="Java API [1.4]" /><link rel="prev" href="java-facets.html" title="Facets" /><link rel="next" href="percolate.html" title="Percolate API" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<!-- For third-generation iPad with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">

	<!-- For iPhone with high-resolution Retina display: -->

	<link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">

	<!-- For first- and second-generation iPad: -->

	<link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />	
	<link type="text/css" rel="stylesheet" href="/static/css/style.css" />	
	<script src="/static/js/skel.min.js"></script>
	<script type="text/javascript">form_name = "guide_template"</script>
	<script src="/static/js/init.js"></script>
	<script src="/static/js/classie.js"></script>
	

	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>

	

<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			

<div class="container">
	<div class="row">
		<div class="12u">
			<section>
				<div class="row">
					<div class="8u 6u(small) 6u(xsmall)">
						<div id="elastic">
							<h1><a href="/"></a></h1>
						</div>
						<!-- Searchbar Input box -->
						<form method="get" action="/search" name="searchForm" class="header-search-form">
						   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
						</form>
						<div class="mobile-auto-complete"></div> 
					</div>
					<div class="4u 6u(small) 6u(xsmall)">
						<!-- Mobile Menu -->
						<div class="mobile-menu-wrapper">
							<ul class="m-shortcuts">
								<li><a id="header-search" class="m-search" href="#"></a></li>
								<li><a class="m-guide" href="/guide"></a></li>
							</ul>											
							<nav class="nav-menu">
								<div class="menu-button">
									<span></span>
								</div>
								<div class="nav-menu-list-wrap">
									<div class="nav-menu-list">
										<h3><a href="/products">Products</a></h3>
										<ul>
											<li><a href="/products/elasticsearch">Elasticsearch</a></li>
											<li><a href="/products/logstash">Logstash</a></li>
											<li><a href="/products/kibana">Kibana</a></li>
											<li><a href="/products/shield">Shield</a></li>
											<li><a href="/products/marvel">Marvel</a></li>
											<li><a href="/products/hadoop">Hadoop</a></li>
											<li><a href="/subscriptions">Support</a></li>
											<li><a href="/downloads">Downloads</a></li>
										</ul>
										<h3><a href="/subscriptions">Subscriptions</a></h3>
										<h3><a href="/learn">Learn</a></h3>
										<ul>
											<li><a href="/guide">Docs</a></li>
											<li><a href="/videos">Videos</a></li>
											<li><a href="http://purchases.elasticsearch.com" target="_blank">Training</a></li>
											<li><a href="/blog">Blog</a></li>
											<li><a href="/elasticon">elastic{ON}</a></li>
										</ul>
										<h3><a href="/community">Community</a></h3>
										<ul>
											<li><a href="/community/meetups">Meetups</a></li>
										</ul>
										<h3><a href="/use-cases">Use Cases</a></h3>
										<h3><a href="/about">About</a></h3>
										<ul>
											<li><a href="/about/leadership">Leadership</a></li>
											<li><a href="/about/board">Board of Directors</a></li>
											<li><a href="/about/careers">Careers</a></li>
											<li><a href="/about/partners">Partners</a></li>
											<li><a href="/about/press">Press</a></li>
										</ul>
									</div>
								</div>
							</nav>
						</div>
						<!-- Shortcuts -->
						<nav id="shortcuts">
							<ul class="links">
								
									<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
								
									<li class="sc-docs grayscale"><a href="/guide" id="header_guide">docs</a></li>
								
									<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
								
									<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
								
							</ul>
						</nav>
					</div>
				</div>
			</section>
			

<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elastic.co" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="elastic{search}" id="autocomplete">
					<button class="button icon" onclick="searchForm.submit()">GO</button>
				</form>
			</div>
			<div class="nav-auto-complete"></div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-docs{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Java API
      [1.4]
    </a></span> » <span class="breadcrumb-node">Aggregations</span></div><div class="navheader"><span class="prev"><a href="java-facets.html">
              « 
              Facets</a>
           
        </span><span class="next">
           
          <a href="percolate.html">Percolate API
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="java-aggs"></a>Aggregations<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggs.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="toc"><dl><dt><span class="preface"><a href="java-api.html">Preface</a></span></dt><dt><span class="chapter"><a href="_maven_repository.html">Maven Repository</a></span></dt><dt><span class="chapter"><a href="_deploying_in_jboss_eap6_module.html">Deploying in JBoss EAP6 module</a></span></dt><dt><span class="chapter"><a href="client.html">Client</a></span></dt><dt><span class="chapter"><a href="index_.html">Index API</a></span></dt><dt><span class="chapter"><a href="get.html">Get API</a></span></dt><dt><span class="chapter"><a href="delete.html">Delete API</a></span></dt><dt><span class="chapter"><a href="java-update-api.html">Update API</a></span></dt><dt><span class="chapter"><a href="bulk.html">Bulk API</a></span></dt><dt><span class="chapter"><a href="search.html">Search API</a></span></dt><dt><span class="chapter"><a href="count.html">Count API</a></span></dt><dt><span class="chapter"><a href="delete-by-query.html">Delete By Query API</a></span></dt><dt><span class="chapter"><a href="java-facets.html">Facets</a></span></dt><dt><span class="chapter"><a href="java-aggs.html">Aggregations</a></span></dt><dt><span class="chapter"><a href="percolate.html">Percolate API</a></span></dt><dt><span class="chapter"><a href="query-dsl-queries.html">Query DSL - Queries</a></span></dt><dt><span class="chapter"><a href="query-dsl-filters.html">Query DSL - Filters</a></span></dt></dl></div><p>Elasticsearch provides a full Java API to play with aggregations. See the
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_top">Aggregations guide</a>.</p><p>Use the factory for aggregation builders (<code class="literal">AggregationBuilders</code>) and add each aggregation
you want to compute when querying and add it to your search request:</p><pre class="programlisting prettyprint lang-java">SearchResponse sr = node.client().prepareSearch()
        .setQuery( /* your query */ )
        .addAggregation( /* add an aggregation */ )
        .execute().actionGet();</pre><p>Note that you can add more than one aggregation. See
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-search.html" target="_top">Search Java API</a> for details.</p><p>To build aggregation requests, use <code class="literal">AggregationBuilders</code> helpers. Just import them
in your class:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.AggregationBuilders;</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_structuring_aggregations"></a>Structuring aggregations<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggs.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>As explained in the
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_top">Aggregations guide</a>, you can define
sub aggregations inside an aggregation.</p><p>An aggregation could be a metrics aggregation or a bucket aggregation.</p><p>For example, here is a 3 levels aggregation composed of:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Terms aggregation (bucket)
</li><li class="listitem">
Date Histogram aggregation (bucket)
</li><li class="listitem">
Average aggregation (metric)
</li></ul></div><pre class="programlisting prettyprint lang-java">SearchResponse sr = node.client().prepareSearch()
    .addAggregation(
        AggregationBuilders.terms("by_country").field("country")
        .subAggregation(AggregationBuilders.dateHistogram("by_year")
            .field("dateOfBirth")
            .interval((DateHistogram.Interval.YEAR)
            .subAggregation(AggregationBuilders.avg("avg_children").field("children"))
        )
    )
    .execute().actionGet();</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_metrics_aggregations"></a>Metrics aggregations<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggs.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-min"></a>Min Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/min-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-min-aggregation.html" target="_top">Min Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/min-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .min("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/min-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.min.Min;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Min agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-max"></a>Max Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/max-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-max-aggregation.html" target="_top">Max Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_2"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/max-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .max("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_2"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/max-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.max.Max;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Max agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-sum"></a>Sum Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/sum-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-sum-aggregation.html" target="_top">Sum Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_3"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/sum-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .sum("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_3"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/sum-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.sum.Sum;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Sum agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-avg"></a>Avg Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/avg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-avg-aggregation.html" target="_top">Avg Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_4"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/avg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .avg("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_4"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/avg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.avg.Avg;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Avg agg = sr.getAggregations().get("agg");
double value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-stats"></a>Stats Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/stats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-stats-aggregation.html" target="_top">Stats Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_5"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/stats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .stats("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_5"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/stats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.stats.Stats;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Stats agg = sr.getAggregations().get("agg");
double min = agg.getMin();
double max = agg.getMax();
double avg = agg.getAvg();
double sum = agg.getSum();
long count = agg.getCount();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-extendedstats"></a>Extended Stats Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-extendedstats-aggregation.html" target="_top">Extended Stats Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_6"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .extendedStats("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_6"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.stats.extended.ExtendedStats;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Stats agg = sr.getAggregations().get("agg");
double min = agg.getMin();
double max = agg.getMax();
double avg = agg.getAvg();
double sum = agg.getSum();
long count = agg.getCount();
double stdDeviation = agg.getStdDeviation();
double sumOfSquares = agg.getSumOfSquares();
double variance = agg.getVariance();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-valuecount"></a>Value Count Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/valuecount-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-valuecount-aggregation.html" target="_top">Value Count Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_7"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/valuecount-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .count("agg")
                .field("height");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_7"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/valuecount-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.valuecount.ValueCount;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
ValueCount agg = sr.getAggregations().get("agg");
long value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-percentile"></a>Percentile Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-percentile-aggregation.html" target="_top">Percentile Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_8"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles("agg")
                .field("height");</pre><p>You can provide your own percentiles instead of using defaults:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles("agg")
                .field("height")
                .percentiles(1.0, 5.0, 10.0, 20.0, 30.0, 75.0, 95.0, 99.0);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_8"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.percentiles.Percentile;
import org.elasticsearch.search.aggregations.metrics.percentiles.Percentiles;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Percentiles agg = sr.getAggregations().get("agg");
// For each entry
for (Percentile entry : agg) {
    double percent = entry.getPercent();    // Percent
    double value = entry.getValue();        // Value

    logger.info("percent [{}], value [{}]", percent, value);
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">percent [1.0], value [0.814338896154595]
percent [5.0], value [0.8761912455821302]
percent [25.0], value [1.173346540141847]
percent [50.0], value [1.5432023318692198]
percent [75.0], value [1.923915462033674]
percent [95.0], value [2.2273644908535335]
percent [99.0], value [2.284989339108279]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-percentile-rank"></a>Percentile Ranks Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-percentile-rank-aggregation.html" target="_top">Percentile Ranks Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_9"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .percentileRanks("agg")
                .field("height")
                .percentiles(1.24, 1.91, 2.22);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_9"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.percentiles.Percentile;
import org.elasticsearch.search.aggregations.metrics.percentiles.PercentileRanks;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
PercentileRanks agg = sr.getAggregations().get("agg");
// For each entry
for (Percentile entry : agg) {
    double percent = entry.getPercent();    // Percent
    double value = entry.getValue();        // Value

    logger.info("percent [{}], value [{}]", percent, value);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">percent [29.664353095090945], value [1.24]
percent [73.9335313461868], value [1.91]
percent [94.40095147327283], value [2.22]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-cardinality"></a>Cardinality Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-cardinality-aggregation.html" target="_top">Cardinality Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_10"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .cardinality("agg")
                .field("tags");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_10"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.cardinality.Cardinality;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Cardinality agg = sr.getAggregations().get("agg");
long value = agg.getValue();</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-geobounds"></a>Cardinality Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/geobounds-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-geobounds-aggregation.html" target="_top">Geo Bounds Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_11"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/geobounds-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">GeoBoundsBuilder aggregation =
        AggregationBuilders
                .geoBounds("agg")
                .field("address.location")
                .wrapLongitude(true);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_11"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/geobounds-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.metrics.geobounds.GeoBounds;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
GeoBounds agg = sr.getAggregations().get("agg");
GeoPoint bottomRight = agg.bottomRight();
GeoPoint topLeft = agg.topLeft();
logger.info("bottomRight {}, topLeft {}", bottomRight, topLeft);</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">bottomRight [40.70500764381921, 13.952946866893775], topLeft [53.49603022435221, -4.190029308156676]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-tophits"></a>Top Hits Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-top-hits-aggregation.html" target="_top">Top Hits Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_12"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms("agg").field("gender")
        .subAggregation(
            AggregationBuilders.topHits("top")
        );</pre><p>You can use most of the options available for standard search such as <code class="literal">from</code>, <code class="literal">size</code>, <code class="literal">sort</code>, <code class="literal">highlight</code>, <code class="literal">explain</code>…</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms("agg").field("gender")
        .subAggregation(
            AggregationBuilders.topHits("top")
                .setExplain(true)
                .setSize(1)
                .setFrom(10)
        );</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_12"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;
import org.elasticsearch.search.aggregations.metrics.tophits.TopHits;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Terms agg = sr.getAggregations().get("agg");

// For each entry
for (Terms.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // bucket key
    long docCount = entry.getDocCount();            // Doc count
    logger.info("key [{}], doc_count [{}]", key, docCount);

    // We ask for top_hits for each bucket
    TopHits topHits = entry.getAggregations().get("top");
    for (SearchHit hit : topHits.getHits().getHits()) {
        logger.info(" -&gt; id [{}], _source [{}]", hit.getId(), hit.getSourceAsString());
    }
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">key [male], doc_count [5107]
 -&gt; id [AUnzSZze9k7PKXtq04x2], _source [{"gender":"male",...}]
 -&gt; id [AUnzSZzj9k7PKXtq04x4], _source [{"gender":"male",...}]
 -&gt; id [AUnzSZzl9k7PKXtq04x5], _source [{"gender":"male",...}]
key [female], doc_count [4893]
 -&gt; id [AUnzSZzM9k7PKXtq04xy], _source [{"gender":"female",...}]
 -&gt; id [AUnzSZzp9k7PKXtq04x8], _source [{"gender":"female",...}]
 -&gt; id [AUnzSZ0W9k7PKXtq04yS], _source [{"gender":"female",...}]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-metrics-scripted-metric"></a>Scripted Metric Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-metrics-scripted-metric-aggregation.html" target="_top">Scripted Metric Aggregation</a>
with Java API.</p><p>Don’t forget to add Groovy in your classpath if you want to run Groovy scripts in an embedded data node
(for unit tests for example).
For example, with Maven, add this dependency to your <code class="literal">pom.xml</code> file:</p><pre class="programlisting prettyprint lang-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
    &lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
    &lt;version&gt;2.3.2&lt;/version&gt;
    &lt;classifier&gt;indy&lt;/classifier&gt;
&lt;/dependency&gt;</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_13"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .scriptedMetric("agg")
                .initScript("_agg['heights'] = []")
                .mapScript("if (doc['gender'].value == \"male\") " +
                        "{ _agg.heights.add(doc['height'].value) } " +
                        "else " +
                        "{ _agg.heights.add(-1 * doc['height'].value) }");</pre><p>You can also specify a <code class="literal">combine</code> script which will be executed on each shard:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .scriptedMetric("agg")
                .initScript("_agg['heights'] = []")
                .mapScript("if (doc['gender'].value == \"male\") " +
                        "{ _agg.heights.add(doc['height'].value) } " +
                        "else " +
                        "{ _agg.heights.add(-1 * doc['height'].value) }")
                .combineScript("heights_sum = 0; for (t in _agg.heights) { heights_sum += t }; return heights_sum");</pre><p>You can also specify a <code class="literal">reduce</code> script which will be executed on the node which gets the request:</p><pre class="programlisting prettyprint lang-java">MetricsAggregationBuilder aggregation =
        AggregationBuilders
                .scriptedMetric("agg")
                .initScript("_agg['heights'] = []")
                .mapScript("if (doc['gender'].value == \"male\") " +
                        "{ _agg.heights.add(doc['height'].value) } " +
                        "else " +
                        "{ _agg.heights.add(-1 * doc['height'].value) }")
                .combineScript("heights_sum = 0; for (t in _agg.heights) { heights_sum += t }; return heights_sum")
                .reduceScript("heights_sum = 0; for (a in _aggs) { heights_sum += a }; return heights_sum");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_13"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;
import org.elasticsearch.search.aggregations.metrics.tophits.TopHits;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
ScriptedMetric agg = sr.getAggregations().get("agg");
Object scriptedResult = agg.aggregation();
logger.info("scriptedResult [{}]", scriptedResult);</pre><p>Note that the result depends on the script you built.
For the first example, this will basically produce:</p><pre class="programlisting prettyprint lang-text">scriptedResult object [ArrayList]
scriptedResult [ {
"heights" : [ 1.122218480146643, -1.8148918111233887, -1.7626731575142909, ... ]
}, {
"heights" : [ -0.8046067304119863, -2.0785486707864553, -1.9183567430207953, ... ]
}, {
"heights" : [ 2.092635728868694, 1.5697545960886536, 1.8826954461968808, ... ]
}, {
"heights" : [ -2.1863201099468403, 1.6328549117346856, -1.7078288405893842, ... ]
}, {
"heights" : [ 1.6043904836424177, -2.0736538674414025, 0.9898266674373053, ... ]
} ]</pre><p>The second example will produce:</p><pre class="programlisting prettyprint lang-text">scriptedResult object [ArrayList]
scriptedResult [-41.279615707402876,
                -60.88007362339038,
                38.823270659734256,
                14.840192739445632,
                11.300902755741326]</pre><p>The last example will produce:</p><pre class="programlisting prettyprint lang-text">scriptedResult object [Double]
scriptedResult [2.171917696507009]</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_bucket_aggregations"></a>Bucket aggregations<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggs.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-global"></a>Global Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/global-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-global-aggregation.html" target="_top">Global Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_14"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/global-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .global("agg")
    .subAggregation(AggregationBuilders.terms("genders").field("gender"));</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_14"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/global-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.global.Global;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Global agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-filter"></a>Filter Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/filter-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-filter-aggregation.html" target="_top">Filter Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_15"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/filter-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .filter("agg")
    .filter(FilterBuilders.termFilter("gender", "male"));</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_15"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/filter-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.filter.Filter;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Filter agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-filters"></a>Filters Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/filters-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-filters-aggregation.html" target="_top">Filters Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_16"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/filters-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .filters("agg")
            .filter("men", FilterBuilders.termFilter("gender", "male"))
            .filter("women", FilterBuilders.termFilter("gender", "female"));</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_16"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/filters-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.filters.Filters;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Filters agg = sr.getAggregations().get("agg");

// For each entry
for (Filters.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // bucket key
    long docCount = entry.getDocCount();            // Doc count
    logger.info("key [{}], doc_count [{}]", key, docCount);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">key [men], doc_count [4982]
key [women], doc_count [5018]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-missing"></a>Missing Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/missing-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-missing-aggregation.html" target="_top">Missing Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_17"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/missing-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders.missing("agg").field("gender");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_17"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/missing-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.missing.Missing;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Missing agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-nested"></a>Nested Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-nested-aggregation.html" target="_top">Nested Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_18"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .nested("agg")
    .path("resellers");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_18"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.nested.Nested;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Nested agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-reverse-nested"></a>Reverse Nested Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/reverse-nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-reverse-nested-aggregation.html" target="_top">Reverse Nested Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_19"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/reverse-nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .nested("agg").path("resellers")
        .subAggregation(
                AggregationBuilders
                        .terms("name").field("resellers.name")
                        .subAggregation(
                                AggregationBuilders
                                        .reverseNested("reseller_to_product")
                        )
        );</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_19"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/reverse-nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.nested.Nested;
import org.elasticsearch.search.aggregations.bucket.nested.ReverseNested;
import org.elasticsearch.search.aggregations.bucket.terms.Terms;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Nested agg = sr.getAggregations().get("agg");
Terms name = agg.getAggregations().get("name");
for (Terms.Bucket bucket : name.getBuckets()) {
    ReverseNested resellerToProduct = bucket.getAggregations().get("reseller_to_product");
    resellerToProduct.getDocCount(); // Doc count
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-children"></a>Children Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/children-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-children-aggregation.html" target="_top">Children Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_20"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/children-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
    AggregationBuilders
        .children("agg")
        .childType("reseller");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_20"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/children-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.children.Children;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Children agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-terms"></a>Terms Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html" target="_top">Terms Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_21"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .terms("genders")
    .field("gender");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_21"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Terms genders = sr.getAggregations().get("genders");

// For each entry
for (Terms.Bucket entry : genders.getBuckets()) {
    entry.getKey();      // Term
    entry.getDocCount(); // Doc count
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_order"></a>Order<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Ordering the buckets by their <code class="literal">doc_count</code> in an ascending manner:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(Terms.Order.count(true))</pre><p>Ordering the buckets alphabetically by their terms in an ascending manner:</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(Terms.Order.term(true))</pre><p>Ordering the buckets by single value metrics sub-aggregation (identified by the aggregation name):</p><pre class="programlisting prettyprint lang-java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(Terms.Order.aggregation("avg_height", false))
    .subAggregation(
        AggregationBuilders.avg("avg_height").field("height")
    )</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-significantterms"></a>Significant Terms Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-significantterms-aggregation.html" target="_top">Significant Terms Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_22"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .significantTerms("significant_countries")
                .field("address.country");

// Let say you search for men only
SearchResponse sr = client.prepareSearch()
        .setQuery(QueryBuilders.termQuery("gender", "male"))
        .addAggregation(aggregation)
        .get();</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_22"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.significant.SignificantTerms;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
SignificantTerms agg = sr.getAggregations().get("significant_countries");

// For each entry
for (SignificantTerms.Bucket entry : agg.getBuckets()) {
    entry.getKey();      // Term
    entry.getDocCount(); // Doc count
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-range"></a>Range Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-range-aggregation.html" target="_top">Range Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_23"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .range("agg")
                .field("height")
                .addUnboundedTo(1.0f)               // from -infinity to 1.0 (excluded)
                .addRange(1.0f, 1.5f)               // from 1.0 to 1.5 (excluded)
                .addUnboundedFrom(1.5f);            // from 1.5 to +infinity</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_23"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.range.Range;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Range agg = sr.getAggregations().get("agg");

// For each entry
for (Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();            // Range as key
    Number from = entry.getFrom();          // Bucket from
    Number to = entry.getTo();              // Bucket to
    long docCount = entry.getDocCount();    // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, from, to, docCount);
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">key [*-1.0], from [-Infinity], to [1.0], doc_count [9]
key [1.0-1.5], from [1.0], to [1.5], doc_count [21]
key [1.5-*], from [1.5], to [Infinity], doc_count [20]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-daterange"></a>Date Range Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/daterange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-daterange-aggregation.html" target="_top">Date Range Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_24"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/daterange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateRange("agg")
                .field("dateOfBirth")
                .format("yyyy")
                .addUnboundedTo("1950")    // from -infinity to 1950 (excluded)
                .addRange("1950", "1960")  // from 1950 to 1960 (excluded)
                .addUnboundedFrom("1960"); // from 1960 to +infinity</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_24"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/daterange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.range.date.DateRange;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
DateRange agg = sr.getAggregations().get("agg");

// For each entry
for (DateRange.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // Date range as key
    DateTime fromAsDate = entry.getFromAsDate();    // Date bucket from as a Date
    DateTime toAsDate = entry.getToAsDate();        // Date bucket to as a Date
    long docCount = entry.getDocCount();            // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, fromAsDate, toAsDate, docCount);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">key [*-1950], from [null], to [1950-01-01T00:00:00.000Z], doc_count [8]
key [1950-1960], from [1950-01-01T00:00:00.000Z], to [1960-01-01T00:00:00.000Z], doc_count [5]
key [1960-*], from [1960-01-01T00:00:00.000Z], to [null], doc_count [37]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-iprange"></a>Ip Range Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/iprange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-iprange-aggregation.html" target="_top">Ip Range Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_25"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/iprange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .ipRange("agg")
                .field("ip")
                .addUnboundedTo("192.168.1.0")             // from -infinity to 192.168.1.0 (excluded)
                .addRange("192.168.1.0", "192.168.2.0")    // from 192.168.1.0 to 192.168.2.0 (excluded)
                .addUnboundedFrom("192.168.2.0");          // from 192.168.2.0 to +infinity</pre><p>Note that you could also use ip masks as ranges:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .ipRange("agg")
                .field("ip")
                .addMaskRange("192.168.0.0/32")
                .addMaskRange("192.168.0.0/24")
                .addMaskRange("192.168.0.0/16");</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_25"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/iprange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.range.ipv4.IPv4Range;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
IPv4Range agg = sr.getAggregations().get("agg");

// For each entry
for (IPv4Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // Ip range as key
    String fromAsString = entry.getFromAsString();  // Ip bucket from as a String
    String toAsString = entry.getToAsString();      // Ip bucket to as a String
    long docCount = entry.getDocCount();            // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, fromAsString, toAsString, docCount);
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">key [*-192.168.1.0], from [null], to [192.168.1.0], doc_count [13]
key [192.168.1.0-192.168.2.0], from [192.168.1.0], to [192.168.2.0], doc_count [14]
key [192.168.2.0-*], from [192.168.2.0], to [null], doc_count [23]</pre><p>And for the second one (using Ip masks):</p><pre class="programlisting prettyprint lang-text">key [192.168.0.0/32], from [192.168.0.0], to [192.168.0.1], doc_count [0]
key [192.168.0.0/24], from [192.168.0.0], to [192.168.1.0], doc_count [13]
key [192.168.0.0/16], from [192.168.0.0], to [192.169.0.0], doc_count [50]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-histogram"></a>Histogram Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-histogram-aggregation.html" target="_top">Histogram Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_26"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .histogram("agg")
                .field("height")
                .interval(1);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_26"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.histogram.Histogram;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
Histogram agg = sr.getAggregations().get("agg");

// For each entry
for (Histogram.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();            // Key
    long docCount = entry.getDocCount();    // Doc count
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-datehistogram"></a>Date Histogram Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-datehistogram-aggregation.html" target="_top">Date Histogram Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_27"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram("agg")
                .field("dateOfBirth")
                .interval(DateHistogram.Interval.YEAR);</pre><p>Or if you want to set an interval of 10 days:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram("agg")
                .field("dateOfBirth")
                .interval(DateHistogram.Interval.days(10));</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_27"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.histogram.Histogram;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
DateHistogram agg = sr.getAggregations().get("agg");

// For each entry
for (DateHistogram.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                // Key
    DateTime keyAsDate = entry.getKeyAsDate();  // Key as date
    long docCount = entry.getDocCount();        // Doc count

    logger.info("key [{}], date [{}], doc_count [{}]", key, keyAsDate.getYear(), docCount);
}</pre><p>This will basically produce for the first example:</p><pre class="programlisting prettyprint lang-text">key [1942-01-01T00:00:00.000Z], date [1942], doc_count [1]
key [1945-01-01T00:00:00.000Z], date [1945], doc_count [1]
key [1946-01-01T00:00:00.000Z], date [1946], doc_count [1]
...
key [2005-01-01T00:00:00.000Z], date [2005], doc_count [1]
key [2007-01-01T00:00:00.000Z], date [2007], doc_count [2]
key [2008-01-01T00:00:00.000Z], date [2008], doc_count [3]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-geodistance"></a>Geo Distance Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/geodistance-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-geodistance-aggregation.html" target="_top">Geo Distance Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_28"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/geodistance-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .geoDistance("agg")
                .field("address.location")
                .point(new GeoPoint(48.84237171118314,2.33320027692004))
                .unit(DistanceUnit.KILOMETERS)
                .addUnboundedTo(3.0)
                .addRange(3.0, 10.0)
                .addRange(10.0, 500.0);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_28"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/geodistance-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.range.geodistance.GeoDistance;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
GeoDistance agg = sr.getAggregations().get("agg");

// For each entry
for (GeoDistance.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();            // key as String
    Number from = entry.getFrom();          // bucket from value
    Number to = entry.getTo();              // bucket to value
    long docCount = entry.getDocCount();    // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, from, to, docCount);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">key [*-3.0], from [0.0], to [3.0], doc_count [161]
key [3.0-10.0], from [3.0], to [10.0], doc_count [460]
key [10.0-500.0], from [10.0], to [500.0], doc_count [4925]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="java-aggs-bucket-geohashgrid"></a>Geo Hash Grid Aggregation<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here is how you can use
<a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-geohashgrid-aggregation.html" target="_top">Geo Hash Grid Aggregation</a>
with Java API.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_prepare_aggregation_request_29"></a>Prepare aggregation request<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Here is an example on how to create the aggregation request:</p><pre class="programlisting prettyprint lang-java">AggregationBuilder aggregation =
        AggregationBuilders
                .geohashGrid("agg")
                .field("address.location")
                .precision(4);</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_aggregation_response_29"></a>Use aggregation response<a href="https://github.com/elasticsearch/elasticsearch/edit/1.4/docs/java-api/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Import Aggregation definition classes:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.search.aggregations.bucket.geogrid.GeoHashGrid;</pre><pre class="programlisting prettyprint lang-java">// sr is here your SearchResponse object
GeoHashGrid agg = sr.getAggregations().get("agg");

// For each entry
for (GeoHashGrid.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                        // key as String
    GeoPoint keyAsGeoPoint = entry.getKeyAsGeoPoint();  // key as geo point
    long docCount = entry.getDocCount();                // Doc count

    logger.info("key [{}], point {}, doc_count [{}]", key, keyAsGeoPoint, docCount);
}</pre><p>This will basically produce:</p><pre class="programlisting prettyprint lang-text">key [gbqu], point [47.197265625, -1.58203125], doc_count [1282]
key [gbvn], point [50.361328125, -4.04296875], doc_count [1248]
key [u1j0], point [50.712890625, 7.20703125], doc_count [1156]
key [u0j2], point [45.087890625, 7.55859375], doc_count [1138]
...</pre></div></div></div></div><div class="navfooter"><span class="prev"><a href="java-facets.html">
              « 
              Facets</a>
           
        </span><span class="next">
           
          <a href="percolate.html">Percolate API
               »
            </a></span></div>
<!-- end body -->

            </section>

            <!-- Footer -->
        
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elasticsearch" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script src="/static/js/script.js"></script>
   	
   		

            <script type="text/javascript">
  jQuery(function() {
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + height + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            </body>
        