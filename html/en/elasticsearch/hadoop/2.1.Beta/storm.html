
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Apache Storm support</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop [2.1.Beta]" /><link rel="up" href="reference.html" title="Elasticsearch for Apache Hadoop" /><link rel="prev" href="spark.html" title="Apache Spark support" /><link rel="next" href="mapping.html" title="Mapping and Types" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />		
	
	<script src="/static/js/jquery.min.js"></script>
	<script src="/static/js/loading.js"></script>
	<script src="/static/js/skel.min.js"></script>
	<script src="/static/js/skel-layers.min.js"></script>
	<script src="/static/js/classie.js"></script>	
	<script type="text/javascript">form_name = "common_layout"</script>
	<script src="/static/js/init.js"></script>
	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>



<link rel="stylesheet" type="text/css" href="/static/css/style.css" />
<link rel="stylesheet" type="text/css" href="styles.css" />
<script type="text/javascript">
  jQuery(function() {
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + height + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			

<div class="container">
	<div class="row">
		<div class="12u">
			<section>
				<div class="row">
					<div class="8u 6u(small) 5u(xsmall)">
						<div id="elastic">
							<h1><a href="/"></a></h1>
						</div>
						<!-- Searchbar Input box -->
						<form method="get" action="/search" name="searchForm" class="header-search-form">
						   <input type="text" id="search-header" name="q" class="form-control global-input" placeholder="elastic{search}">
						</form>
					</div>
					<div class="4u 6u(small) 7u(xsmall)">
						<!-- Mobile Menu -->
						<div class="mobile-menu-wrapper">
							<ul class="m-shortcuts">
								<li><a id="header-search" class="m-search" href="#"></a></li>
								<li><a class="m-guide" href="/guide"></a></li>
							</ul>											
							<nav class="nav-menu">
								<div class="menu-button">
									<span></span>
								</div>
								<div class="nav-menu-list-wrap">
									<div class="nav-menu-list">
										<h3><a href="/products">Products</a></h3>
										<ul>
											<li><a href="/products/elasticsearch">Elasticsearch</a></li>
											<li><a href="/products/logstash">Logstash</a></li>
											<li><a href="/products/kibana">Kibana</a></li>
											<li><a href="/products/shield">Shield</a></li>
											<li><a href="/products/marvel">Marvel</a></li>
											<li><a href="/products/hadoop">Hadoop</a></li>
											<li><a href="/subscriptions">Support</a></li>
											<li><a href="/downloads">Downloads</a></li>
										</ul>
										<h3><a href="/subscriptions">Subscriptions</a></h3>
										<h3><a href="/learn">Learn</a></h3>
										<ul>
											<li><a href="/guide">Docs</a></li>
											<li><a href="/videos">Videos</a></li>
											<li><a href="http://purchases.elasticsearch.com" target="_blank">Training</a></li>
											<li><a href="/blog">Blog</a></li>
										</ul>
										<h3><a href="/community">Community</a></h3>
										<ul>
											<li><a href="/community/meetups">Meetups</a></li>
										</ul>
										<h3><a href="/about">About</a></h3>
										<ul>
											<li><a href="/about/leadership">Leadership</a></li>
											<li><a href="/about/board">Board of Directors</a></li>
											<li><a href="/about/careers">Careers</a></li>
											<li><a href="/about/partners">Partners</a></li>
											<li><a href="/about/press">Press</a></li>
										</ul>
									</div>
								</div>
							</nav>
						</div>
						<!-- Shortcuts -->
						<nav id="shortcuts">
							<ul class="links">
								
									<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
								
									<li class="sc-docs grayscale"><a href="/guide" id="header_guide">docs</a></li>
								
									<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
								
									<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
								
							</ul>
						</nav>
					</div>
				</div>
			</section>
			

<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elasticsearch.com" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="{elastic} search">
					<a class="button icon" onclick="searchForm.submit()">GO</a>
				</form>
			</div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-docs{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop
      [2.1.Beta]
    </a></span> » <span class="breadcrumb-link"><a href="reference.html">Elasticsearch for Apache Hadoop </a></span> » <span class="breadcrumb-node">Apache Storm support</span></div><div class="navheader"><span class="prev"><a href="spark.html">
              « 
              Apache Spark support</a>
           
        </span><span class="next">
           
          <a href="mapping.html">Mapping and Types
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="storm"></a>Apache Storm support<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="doc-sections.html">Documentation sections</a></span></dt><dt><span class="chapter"><a href="features.html">Key features</a></span></dt><dt><span class="chapter"><a href="requirements.html">Requirements</a></span></dt><dt><span class="chapter"><a href="install.html">Installation</a></span></dt><dt><span class="chapter"><a href="arch.html">Architecture</a></span></dt><dt><span class="chapter"><a href="configuration.html">Configuration</a></span></dt><dt><span class="chapter"><a href="configuration-runtime.html">Hadoop runtime options</a></span></dt><dt><span class="chapter"><a href="logging.html">Logging</a></span></dt><dt><span class="chapter"><a href="mapreduce.html">Map/Reduce integration</a></span></dt><dt><span class="chapter"><a href="cascading.html">Cascading support</a></span></dt><dt><span class="chapter"><a href="hive.html">Apache Hive integration</a></span></dt><dt><span class="chapter"><a href="pig.html">Apache Pig support</a></span></dt><dt><span class="chapter"><a href="spark.html">Apache Spark support</a></span></dt><dt><span class="chapter"><a href="storm.html">Apache Storm support</a></span></dt><dt><span class="chapter"><a href="mapping.html">Mapping and Types</a></span></dt><dt><span class="chapter"><a href="metrics.html">Hadoop Metrics</a></span></dt><dt><span class="chapter"><a href="troubleshooting.html">Troubleshooting</a></span></dt></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 2.1.</p></div></div><div class="blockquote"><table border="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p><a class="ulink" href="http://storm.incubator.apache.org" target="_top">Apache Storm</a> is a free and open source distributed realtime computation system. Storm makes it easy to reliably process unbounded streams of data, doing for realtime processing what Hadoop did for batch processing.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">
Storm website
</span></td></tr></table></div><p>With Storm, one can compute, transform and filter data typically in a streaming scenario. As opposed to the rest of the libraries mentioned in this documentation, Apache Storm is a computational framework that is not tied to Map/Reduce itself however it does integrate with Hadoop, mainly through HDFS.</p><h3><a id="storm-installation"></a>Installation<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>In order to use elasticsearch-hadoop, its jar needs to be available in Storm’s classpath. The Storm <a class="ulink" href="https://storm.incubator.apache.org/documentation/Documentation.html" target="_top">documentation</a> covers this in detail but in short, one can either have the jar available on all Storm nodes or have elasticsearch-hadoop part of the jar being deploy (which we recommend). The latter approach allows isolation between the jobs and since the jar is self-contained, can be easily be moved across environments without additional setup making it much more robust.</p><h3><a id="storm-configuration"></a>Configuration<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The Storm integration supports the configuration options described in the <a class="xref" href="configuration.html" title="Configuration"><em>Configuration</em></a> chapter plus a few more that are specific to Storm, namely:</p><h4><a id="storm-cfg-spout"></a>Spout specific<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.storm.spout.reliable</code> (default false)
</span></dt><dd>
Indicates whether the dedicated <code class="literal">EsSpout</code> is <span class="emphasis"><em>reliable</em></span>, that is replays the documents in case of failure or not. By default it is set to <code class="literal">false</code> since replaying requires the documents to be kept in memory until are being acknowledged.
</dd><dt><span class="term">
<code class="literal">es.storm.spout.fields</code> (default "")
</span></dt><dd>
Specify what fields <code class="literal">EsSpout</code> will declare in its topology and extract from the returned documents. By default is unset meaning the documents are returned as <code class="literal">Map</code>s under the default field <code class="literal">doc</code>.
</dd><dt><span class="term">
<code class="literal">es.storm.spout.reliable.queue.size</code> (default 0)
</span></dt><dd>
Applicable only if <code class="literal">es.storm.spout.reliable</code> is <code class="literal">true</code>. Sets the size of the queue which holds documents in memory to be replayed until they are acknowledged. By default, the queue is <span class="emphasis"><em>unbounded</em></span> (<code class="literal">0</code>) however in a production environment
it is indicated to limit the queue to limit the consumption of memory. If the queue is full, the <code class="literal">Bolt</code> drops any incoming <code class="literal">Tuple</code>s and throws an exception.
</dd><dt><span class="term">
<code class="literal">es.storm.spout.reliable.retries.per.tuple</code> (default 5)
</span></dt><dd>
Applicable only if <code class="literal">es.storm.spout.reliable</code> is <code class="literal">true</code>. Set the number of retries (replays) of a failed tuple before giving up. Setting it to a negative value will cause the tuple to be replayed until acknowledged.
</dd><dt><span class="term">
<code class="literal">es.storm.spout.reliable.handle.tuple.failure</code> (default abort)
</span></dt><dd><p class="simpara">
Applicable only if <code class="literal">es.storm.spout.reliable</code> is <code class="literal">true</code>. Indicates how to handle failing tuples after the number of retries is depleted. Possible values are :
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">ignore</code>
</span></dt><dd>
the tuple is discarded
</dd><dt><span class="term">
<code class="literal">warn</code>
</span></dt><dd>
a warning message is logged and the tuple is discarded
</dd><dt><span class="term">
<code class="literal">strict</code>
</span></dt><dd>
an exception is thrown, aborting the current job
</dd></dl></div></dd></dl></div><h4><a id="storm-cfg-bolt"></a>Bolt specific<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.storm.bolt.write.ack</code> (default false)
</span></dt><dd>
Indicates whether the dedicated <code class="literal">EsBolt</code> is <span class="emphasis"><em>reliable</em></span>, that is acknowledges the <code class="literal">Tuple</code> <span class="emphasis"><em>after</em></span> it was written to Elasticsearch or the instance it receives it. By default it is <code class="literal">false</code>. Note that turning this on increases the memory requirements of the <code class="literal">Bolt</code> since it has to keep the data in memory until it is fully written.
</dd><dt><span class="term">
<code class="literal">es.storm.bolt.flush.entries.size</code> (default 1000)
</span></dt><dd>
The number of entries that trigger a <span class="emphasis"><em>micro-batch</em></span> write to Elasticsearch. By default, it uses the same value as <code class="literal">es.batch.size.entries</code> which, by default is <code class="literal">1000</code>.
</dd><dt><span class="term">
<code class="literal">es.storm.bolt.tick.tuple.flush</code> (default true)
</span></dt><dd>
Whether or not to flush the existing data if the <code class="literal">Bolt</code> receives a <a class="ulink" href="https://storm.incubator.apache.org/apidocs/" target="_top">Tick</a> tuple. This <span class="emphasis"><em>heart-beat</em></span>-like mechanism goes hand in hand with the flush limit above to create both a time and size trigger.
</dd></dl></div><h4><a id="storm-cfg-set"></a>Setting the configuration<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The configuration can be set through Storm’s <a class="ulink" href="https://storm.incubator.apache.org/apidocs/index.html?backtype/storm/Config.html" target="_top">Config</a> class, in which case they are available <span class="emphasis"><em>globally</em></span> or, individually for each <code class="literal">EsSpout</code> and <code class="literal">EsBolt</code> instance. In general, it is recommended to set globally <span class="emphasis"><em>only</em></span> the properties that apply to all the components and are unlikely to change:</p><pre class="programlisting prettyprint lang-java">Config conf = new Config();
conf.put("es.index.auto.create", "true");
StormSubmitter.submitTopology("myTopology", conf, topology);</pre><p>For this reason, typically, one should use the <span class="emphasis"><em>per-component</em></span> configuration model since it allows different configurations to be used within the same Storm topology:</p><pre class="programlisting prettyprint lang-java">Map conf = new HashMap();
conf.put("es.index.auto.create", "true");
TopologyBuilder builder = new TopologyBuilder();
builder.setSpout("esSpout", new EsSpout("index/type", conf));</pre><h3><a id="storm-write"></a>Writing data to Elasticsearch<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Through elasticsearch-hadoop, Elasticsearch is exposed to Storm through a native <code class="literal">Bolt</code>, namely <code class="literal">org.elasticsearch.storm.EsBolt</code> that writes the Storm <code class="literal">Tuple</code>s to Elasticsearch:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.storm.EsBolt; <a id="CO70-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

TopologyBuilder builder = new TopologyBuilder();
builder.setSpout("spout", new RandomSentenceSpout(), 10);
builder.setBolt("es-bolt", new EsBolt<a id="CO70-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>("storm/docs"<a id="CO70-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>), 5<a id="CO70-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>)
                                    .shuffleGrouping("spout");</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
elasticsearch-hadoop <code class="literal">EsBolt</code> package import
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">EsBolt</code> declaration
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Various constructors are available for <code class="literal">EsBolt</code> - at least the Elasticsearch resource under which the data is indexed, is required
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The number of <code class="literal">EsBolt</code> instances for this topology
</p></td></tr></table></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>The number of bolt instances depends highly on your topology and environment. In general a good rule of thumb is to take into account the number of the target index shards as well as the number of spouts sending data to it - a good formula is to take the minimum between the source spouts and the index shards; in this example 5. A high number of <code class="literal">Bolt</code>s does not translate to a bigger through-put - make sure the <code class="literal">Bolt</code>s are the bottleneck since increasing the number simply translates otherwise to wasted cycles.</p></div></div><p>For cases where the id (or other metadata fields like <code class="literal">ttl</code> or <code class="literal">timestamp</code>) of the document needs to be specified, one can do so by setting the appropriate <a class="link" href="configuration.html#cfg-mapping" title="Mappingedit">mapping</a> namely <code class="literal">es.mapping.id</code>. Thus assuming the documents contain a field called <code class="literal">sentenceId</code> which is unique and is suitable for an identifier, one can update the job configuration as follows:</p><pre class="programlisting prettyprint lang-java">Map conf = new HashMap();
conf.put("es.mapping.id", "sentenceId");
TopologyBuilder builder = new TopologyBuilder();
builder.setSpout("esSpout", new EsSpout("index/type", conf));</pre><h4><a id="storm-write-json"></a>Writing existing JSON to Elasticsearch<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>If the data passed to Storm is already in JSON format, <code class="literal">EsBolt</code> can pass it directly to Elasticsearch <span class="emphasis"><em>without</em></span> any transformation; the data is taken as is and sent over the wire. In such cases, one needs to indicate the JSON input by setting the <code class="literal">es.input.json</code> parameter to <code class="literal">true</code>. Further more,  the <code class="literal">Bolt</code> expects the receiving <code class="literal">Tuple</code> to contain only <span class="emphasis"><em>one</em></span> value/field representing the JSON document. By default, common <span class="emphasis"><em>textual</em></span> types are recognized, such as <code class="literal">chararray</code> or <code class="literal">bytearray</code>; otherwise it falls back to calling <code class="literal">toString</code> to get a hold of the JSON content.</p><pre class="programlisting prettyprint lang-java">String json1 = "{\"reason\" : \"business\",\"airport\" : \"SFO\"}";  <a id="CO71-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
String json2 = "{\"participants\" : 5,\"airport\" : \"OTP\"}";

Map conf = new HashMap();
conf.put("es.input.json", "true"); <a id="CO71-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>

TopologyBuilder builder = new TopologyBuilder();
builder.setSpout("json-spout", new StringSpout<a id="CO71-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>(Arrays.asList(json1, json2));
builder.setBolt("es-bolt", new EsBolt("storm/json-trips", conf<a id="CO71-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>))
                                    .shuffleGrouping("json-spout");</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO71-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
JSON document represented as a <code class="literal">String</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO71-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Option indicating the input is in JSON format
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO71-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Basic <code class="literal">Spout</code> which replays the given <code class="literal">String</code>s as <code class="literal">Tuples</code> with only one value
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO71-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Configure <code class="literal">EsBolt</code> to process JSON - the same setting can be passed through the global <code class="literal">Conf</code> object however it is typically convenient to define it <span class="emphasis"><em>locally</em></span>
</p></td></tr></table></div><h4><a id="storm-write-dyn"></a>Writing to dynamic/multi-resources<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In cases where the data needs to be indexed based on its content, one can choose the target index based on a <code class="literal">Tuple</code> field.  Reusing the aforementioned <a class="link" href="configuration.html#cfg-multi-writes" title="Dynamic/multi resource writesedit">media example</a>, one can <span class="emphasis"><em>partition</em></span> the documents based on their type. Assuming the document tuple contains fields <code class="literal">media_type</code>, <code class="literal">title</code> and <code class="literal">year</code> one can index them as follows:</p><pre class="programlisting prettyprint lang-java">builder.setBolt("es-bolt",
    new EsBolt("my-collection/{media_type}"<a id="CO72-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>)).shuffleGrouping("spout");</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO72-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Resource pattern using field <code class="literal">type</code>
</p></td></tr></table></div><p>For each tuple about to be written, elasticsearch-hadoop will extract the <code class="literal">type</code> field and use its value to determine the target resource. The functionality is also available when dealing with raw JSON - in this case, the value will be extracted from the JSON document itself.</p><p>The functionality is also available when dealing with raw JSON - in this case, the value will be extracted from the JSON document itself. Assuming the JSON source contains documents with the following structure:</p><pre class="programlisting prettyprint lang-js">{
    "media_type":"game",<a id="CO73-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "title":"Final Fantasy VI",
    "year":"1994"
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO73-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
field within the JSON document that will be used by the pattern
</p></td></tr></table></div><p>the <code class="literal">EsBolt</code> with the configuration:</p><pre class="programlisting prettyprint lang-java">Map conf = new HashMap();
conf.put("es.input.json", "true"); <a id="CO74-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

builder.setBolt("es-bolt",
    new EsBolt("my-collection-{media_type}/{year}"<a id="CO74-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>, conf<a id="CO74-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>)).shuffleGrouping("spout");</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO74-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Option indicating the input is in JSON format
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO74-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Resource pattern - notice how the pattern is used both in the index and the type
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO74-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Pass configuration to <code class="literal">EsBolt</code> to indicate the JSON input
</p></td></tr></table></div><h4><a id="storm-read"></a>Reading data from Elasticsearch<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>As you can expect, for reading data (typically executing queries) elasticsearch-hadoop offers a dedicated <code class="literal">Spout</code> through <code class="literal">org.elasticsearch.storm.EsSpout</code> which executes the query in Elasticsearch and <span class="emphasis"><em>streams</em></span> the results back to Apache Storm:</p><pre class="programlisting prettyprint lang-java">import org.elasticsearch.storm.EsSpout; <a id="CO75-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

TopologyBuilder builder = new TopologyBuilder();
builder.setSpout("es-spout", new EsSpout<a id="CO75-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>("storm/docs"<a id="CO75-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>, "?q=me*<a id="CO75-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>), 5<a id="CO75-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>);
builder.setBolt("bolt", new PrinterBolt()).shuffleGrouping("es-spout");</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
elasticsearch-hadoop <code class="literal">EsSpout</code> package import
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">EsSpout</code> declaration
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The source Elasticsearch resource (index and type) for the data
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The query to execute (optional) - if no query is specified, the entire indexed data is streamed
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The number of <code class="literal">EsSpout</code> instances for this topology. The number should <span class="strong"><strong>not</strong></span> be greater than the number of shards available for an index; if it does, it just wastes CPU cycles without improving performance.
</p></td></tr></table></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>The number of <code class="literal">Spout</code> instances depends highly on your topology and environment. Typically you should use the number of shards of your target data as an indicator - if you index has 5 shards, create 5 <code class="literal">EsSpout</code>s; however sometimes the shards number might be considerably bigger than the number of <code class="literal">Spout</code>s you can add to your Apache Storm cluster; in that case, it is better to limit the number of <code class="literal">EsSpout</code> instances. Last but not least, adding more <code class="literal">EsSpout</code> instances than the number of shards of the source index does <span class="strong"><strong>not</strong></span> improve performance; in fact the extra instances will just waste resources without processing anything.</p></div></div><h5><a id="_customizing_literal_esspout_literal_fields"></a>Customizing <code class="literal">EsSpout</code> fields<a href="https://github.com/elasticsearch/elasticsearch-hadoop/edit/2.1.Beta/docs/src/reference/asciidoc/core/storm.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Since Storm requires each <code class="literal">Spout</code> to declare its fields when creating a topology, by default <code class="literal">EsSpout</code> declares for its tuples a generic <code class="literal">doc</code> field containing the documents returned (one per tuple) from Elasticsearch. When dealing with structured data (documents sharing the same fields), one can configure the <code class="literal">EsSpout</code> to <span class="emphasis"><em>declare</em></span> as fields the document properties effectively <span class="emphasis"><em>unwrapping</em></span> the document as a <code class="literal">Tuple</code>. By setting up <code class="literal">es.storm.spout.fields</code>, <code class="literal">EsSpout</code> will use them indicate to the Storm topology the tuple content and extract them from the returned document.</p><p>For example if the Elasticsearch documents contain 3 fields: <code class="literal">name</code>, <code class="literal">age</code> and <code class="literal">gender</code> by setting <code class="literal">es.storm.spout.fields</code> to <code class="literal">name, age, gender</code>, instead of returning a tuple with one field (<code class="literal">doc</code>, containing the document), a tuple containing
the three named fields (<code class="literal">name</code>, <code class="literal">age</code> and <code class="literal">gender</code>) will be returned instead.</p></div><div class="navfooter"><span class="prev"><a href="spark.html">
              « 
              Apache Spark support</a>
           
        </span><span class="next">
           
          <a href="mapping.html">Mapping and Types
               »
            </a></span></div>
<!-- end body -->

            </section>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            <!-- Footer -->
        
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div>
<!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elasticsearch" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elasticsearch" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<div class="preloader">
    	<div class="status"></div>
	</div>
  	<style></style>
   	<link type="text/css" rel="stylesheet" href="/static/css/flexslider.css" >

<script src="/static/js/jquery.flexslider.min.js"></script>
<script src="/static/js/jquery.dropdown.min.js"></script>
<script src="/static/js/script.js"></script>
   	
</body>