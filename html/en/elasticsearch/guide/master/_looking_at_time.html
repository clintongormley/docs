
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Looking at Time</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide" /><link rel="up" href="aggregations.html" title="Aggregations" /><link rel="prev" href="_building_bar_charts.html" title="Building Bar Charts" /><link rel="next" href="_returning_empty_buckets.html" title="Returning Empty Buckets" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />		
	
	<script src="/static/js/jquery.min.js"></script>
	<script src="/static/js/loading.js"></script>
	<script src="/static/js/skel.min.js"></script>
	<script src="/static/js/skel-layers.min.js"></script>
	<script src="/static/js/classie.js"></script>	
	<script type="text/javascript">form_name = "common_layout"</script>
	<script src="/static/js/init.js"></script>
	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>



<link rel="stylesheet" type="text/css" href="/static/css/style.css" />
<link rel="stylesheet" type="text/css" href="styles.css" />
<script type="text/javascript">
  jQuery(function() {
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + height + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			

<div class="container">
	<div class="row">
		<div class="12u">
			<section>
				<div class="row">
					<div class="8u 6u(small) 5u(xsmall)">
						<div id="elastic">
							<h1><a href="/"></a></h1>
						</div>
						<!-- Searchbar Input box -->
						<div class="header-search-form">
						   <input type="text" id="search-header" name="q" class="form-control global-input" placeholder="{elastic} search">
						</div>
					</div>
					<div class="4u 6u(small) 7u(xsmall)">
						<!-- Mobile Menu -->
						<div class="mobile-menu-wrapper">
							<ul class="m-shortcuts">
								<li><a id="header-search" class="m-search" href="#"></a></li>
								<li><a class="m-guide" href="#"></a></li>
							</ul>											
							<nav class="nav-menu">
								<div class="menu-button">
									<span></span>
								</div>
								<div class="nav-menu-list-wrap">
									<div class="nav-menu-list">
										<h3><a href="#">Products</a></h3>
										<ul>
											<li><a href="#">elasticsearch</a></li>
											<li><a href="#">logstash</a></li>
											<li><a href="#">kibana</a></li>
											<li><a href="#">shield</a></li>
											<li><a href="#">marvel</a></li>
											<li><a href="#">hadoop</a></li>
											<li><a href="#">support</a></li>
											<li><a href="#">downloads</a></li>
										</ul>
										<h3><a href="#">SUBSCRIPTIONS</a></h3>
										<h3><a href="#">LEARN</a></h3>
										<ul>
											<li><a href="#">guide</a></li>
											<li><a href="#">videos</a></li>
											<li><a href="#">training</a></li>
											<li><a href="#">blog</a></li>
										</ul>
									</div>
								</div>
							</nav>
						</div>
						<!-- Shortcuts -->
						<nav id="shortcuts">
							<ul class="links">
								
									<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
								
									<li class="sc-guide grayscale"><a href="/guide" id="header_guide">guide</a></li>
								
									<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
								
									<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
								
							</ul>
						</nav>
					</div>
				</div>
			</section>
			

<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >guide</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elasticsearch.com" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="{elastic} search">
					<a class="button icon" onclick="searchForm.submit()">GO</a>
				</form>
			</div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-guide{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide</a></span> » <span class="breadcrumb-link"><a href="aggregations.html">Aggregations </a></span> » <span class="breadcrumb-node">Looking at Time</span></div><div class="navheader"><span class="prev"><a href="_building_bar_charts.html">
              « 
              Building Bar Charts</a>
           
        </span><span class="next">
           
          <a href="_returning_empty_buckets.html">Returning Empty Buckets
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_looking_at_time"></a>Looking at Time<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/300_Aggregations/35_date_histogram.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="_returning_empty_buckets.html">Returning Empty Buckets</a></span></dt><dt><span class="section"><a href="_extended_example.html">Extended Example</a></span></dt><dt><span class="section"><a href="_the_sky_8217_s_the_limit.html">The Sky’s the Limit</a></span></dt></dl></div><p>If search is the most popular activity in Elasticsearch, building date
histograms must be the second most popular.<a id="id-1.7.6.2.1" class="indexterm"></a><a id="id-1.7.6.2.2" class="indexterm"></a>
<a id="id-1.7.6.2.3" class="indexterm"></a><a id="id-1.7.6.2.4" class="indexterm"></a>
<a id="id-1.7.6.2.5" class="indexterm"></a>  Why would you want to use a date
histogram?</p><p>Imagine your data has a timestamp.<a id="id-1.7.6.3.1" class="indexterm"></a>  It doesn’t matter what the data is—Apache
log events, stock buy/sell transaction dates, baseball game times—anything with a timestamp can benefit from the date histogram.  When you have
a timestamp, you often want to build metrics that are expressed <span class="emphasis"><em>over time</em></span>:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
How many cars sold each month this year?
</li><li class="listitem">
What was the price of this stock for the last 12 hours?
</li><li class="listitem">
What was the average latency of our website every hour in the last week?
</li></ul></div><p>While regular histograms are often represented as bar charts, date histograms
tend to be converted into line graphs representing time series.<a id="id-1.7.6.5.1" class="indexterm"></a>
<a id="id-1.7.6.5.2" class="indexterm"></a>  Many
companies use Elasticsearch <span class="emphasis"><em>solely</em></span> for analytics over time series data.  The <code class="literal">date_histogram</code> bucket is their bread and butter.</p><p>The <code class="literal">date_histogram</code> bucket works<a id="id-1.7.6.6.2" class="indexterm"></a>
<a id="id-1.7.6.6.3" class="indexterm"></a> similarly to the regular <code class="literal">histogram</code>.  Rather
than building buckets based on a numeric field representing numeric ranges,
it builds buckets based on time ranges.  Each bucket is therefore defined as a
certain calendar size (for example, <code class="literal">1 month</code> or <code class="literal">2.5 days</code>).</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Can a Regular Histogram Work with Dates?</strong></p></div></div></div><p>Technically, yes.<a id="id-1.7.6.7.2.1" class="indexterm"></a>
<a id="id-1.7.6.7.2.2" class="indexterm"></a>  A regular <code class="literal">histogram</code> bucket will work with dates.  However,
it is not calendar-aware.  With the <code class="literal">date_histogram</code>, you can specify intervals
such as <code class="literal">1 month</code>, which knows that February is shorter than December.  The
<code class="literal">date_histogram</code> also has the advantage of being able to work with time zones,
which allows you to customize graphs to the time zone of the user, not the server.</p><p>The regular histogram will interpret dates as numbers, which means you must specify
intervals in terms of milliseconds.  And the aggregation doesn’t know about
calendar intervals, which makes it largely useless for dates.</p></div><p>Our first example <a id="id-1.7.6.8.1" class="indexterm"></a>will build a simple line chart to answer this question:
how many cars were sold each month?</p><pre class="programlisting prettyprint lang-js">GET /cars/transactions/_search?search_type=count
{
   "aggs": {
      "sales": {
         "date_histogram": {
            "field": "sold",
            "interval": "month", <a id="CO194-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "format": "yyyy-MM-dd" <a id="CO194-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
         }
      }
   }
}</pre><a class="sense_widget" href="sense_widget.html?snippets/300_Aggregations/35_date_histogram.json" target="sense">View in Sense</a><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO194-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The interval is requested in calendar terminology (for example, one month per bucket).

</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO194-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We provide a date format so that bucket keys are pretty.
</p></td></tr></table></div><p>Our query has a single aggregation, which builds a bucket
per month.  This will give us the number of cars sold in each month.  An additional
<code class="literal">format</code> parameter is provided so the buckets have "pretty" keys.  Internally,
dates are simply represented as a numeric value.  This tends to make UI designers
grumpy, however, so a prettier format can be specified using common date formatting.</p><p>The response is both expected and a little surprising (see if you can spot
the surprise):</p><pre class="programlisting prettyprint lang-js">{
   ...
   "aggregations": {
      "sales": {
         "buckets": [
            {
               "key_as_string": "2014-01-01",
               "key": 1388534400000,
               "doc_count": 1
            },
            {
               "key_as_string": "2014-02-01",
               "key": 1391212800000,
               "doc_count": 1
            },
            {
               "key_as_string": "2014-05-01",
               "key": 1398902400000,
               "doc_count": 1
            },
            {
               "key_as_string": "2014-07-01",
               "key": 1404172800000,
               "doc_count": 1
            },
            {
               "key_as_string": "2014-08-01",
               "key": 1406851200000,
               "doc_count": 1
            },
            {
               "key_as_string": "2014-10-01",
               "key": 1412121600000,
               "doc_count": 1
            },
            {
               "key_as_string": "2014-11-01",
               "key": 1414800000000,
               "doc_count": 2
            }
         ]
...
}</pre><p>The aggregation is represented in full.  As you can see, we have buckets
that represent months, a count of docs in each month, and our pretty <code class="literal">key_as_string</code>.</p></div><div class="navfooter"><span class="prev"><a href="_building_bar_charts.html">
              « 
              Building Bar Charts</a>
           
        </span><span class="next">
           
          <a href="_returning_empty_buckets.html">Returning Empty Buckets
               »
            </a></span></div>
<!-- end body -->

            </section>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            <!-- Footer -->
        
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
						<p>&copy; 2015. All Rights Reserved - Elasticsearch</p>
						<ul class="links">
							<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
							
							<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
							
							<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
							
							<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
							
						</ul>
					</div>
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elastic.co" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elasticsearch" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<div class="preloader">
    	<div class="status"></div>
	</div>
  	<style></style>
   	<link type="text/css" rel="stylesheet" href="/static/css/flexslider.css" >

<script src="/static/js/jquery.flexslider.min.js"></script>
<script src="/static/js/jquery.dropdown.min.js"></script>
<script src="/static/js/script.js"></script>
   	
</body>