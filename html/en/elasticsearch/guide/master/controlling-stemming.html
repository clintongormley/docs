
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Controlling Stemming</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide" /><link rel="up" href="stemming.html" title="Reducing Words to Their Root Form" /><link rel="prev" href="choosing-a-stemmer.html" title="Choosing a Stemmer" /><link rel="next" href="stemming-in-situ.html" title="Stemming in situ" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />		
	
	<script src="/static/js/jquery.min.js"></script>
	<script src="/static/js/loading.js"></script>
	<script src="/static/js/skel.min.js"></script>
	<script src="/static/js/skel-layers.min.js"></script>
	<script src="/static/js/classie.js"></script>	
	<script type="text/javascript">form_name = "common_layout"</script>
	<script src="/static/js/init.js"></script>
	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>



<link rel="stylesheet" type="text/css" href="/static/css/style.css" />
<link rel="stylesheet" type="text/css" href="styles.css" />
<script type="text/javascript">
  jQuery(function() {
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + height + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			

<div class="container">
	<div class="row">
		<div class="12u">
			<section>
				<div class="row">
					<div class="8u 6u(small) 5u(xsmall)">
						<div id="elastic">
							<h1><a href="/"></a></h1>
						</div>
						<!-- Searchbar Input box -->
						<form method="get" action="/search" name="searchForm" class="header-search-form">
						   <input type="text" id="search-header" name="q" class="form-control global-input" placeholder="elastic{search}">
						</form>
					</div>
					<div class="4u 6u(small) 7u(xsmall)">
						<!-- Mobile Menu -->
						<div class="mobile-menu-wrapper">
							<ul class="m-shortcuts">
								<li><a id="header-search" class="m-search" href="#"></a></li>
								<li><a class="m-guide" href="/guide"></a></li>
							</ul>											
							<nav class="nav-menu">
								<div class="menu-button">
									<span></span>
								</div>
								<div class="nav-menu-list-wrap">
									<div class="nav-menu-list">
										<h3><a href="/products">Products</a></h3>
										<ul>
											<li><a href="/products/elasticsearch">Elasticsearch</a></li>
											<li><a href="/products/logstash">Logstash</a></li>
											<li><a href="/products/kibana">Kibana</a></li>
											<li><a href="/products/shield">Shield</a></li>
											<li><a href="/products/marvel">Marvel</a></li>
											<li><a href="/products/hadoop">Hadoop</a></li>
											<li><a href="/subscriptions">Support</a></li>
											<li><a href="/downloads">Downloads</a></li>
										</ul>
										<h3><a href="/subscriptions">Subscriptions</a></h3>
										<h3><a href="/learn">Learn</a></h3>
										<ul>
											<li><a href="/guide">Docs</a></li>
											<li><a href="/videos">Videos</a></li>
											<li><a href="http://purchases.elasticsearch.com" target="_blank">Training</a></li>
											<li><a href="/blog">Blog</a></li>
										</ul>
										<h3><a href="/community">Community</a></h3>
										<ul>
											<li><a href="/community/meetups">Meetups</a></li>
										</ul>
										<h3><a href="/about">About</a></h3>
										<ul>
											<li><a href="/about/leadership">Leadership</a></li>
											<li><a href="/about/board">Board of Directors</a></li>
											<li><a href="/about/careers">Careers</a></li>
											<li><a href="/about/partners">Partners</a></li>
											<li><a href="/about/press">Press</a></li>
										</ul>
									</div>
								</div>
							</nav>
						</div>
						<!-- Shortcuts -->
						<nav id="shortcuts">
							<ul class="links">
								
									<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
								
									<li class="sc-docs grayscale"><a href="/guide" id="header_guide">docs</a></li>
								
									<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
								
									<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
								
							</ul>
						</nav>
					</div>
				</div>
			</section>
			

<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elasticsearch.com" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="{elastic} search">
					<a class="button icon" onclick="searchForm.submit()">GO</a>
				</form>
			</div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-docs{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide</a></span> » <span class="breadcrumb-link"><a href="languages.html">Dealing with Human Language </a></span> » <span class="breadcrumb-link"><a href="stemming.html">Reducing Words to Their Root Form</a></span> » <span class="breadcrumb-node">Controlling Stemming</span></div><div class="navheader"><span class="prev"><a href="choosing-a-stemmer.html">
              « 
              Choosing a Stemmer</a>
           
        </span><span class="next">
           
          <a href="stemming-in-situ.html">Stemming in situ
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="controlling-stemming"></a>Controlling Stemming<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/230_Stemming/50_Controlling_stemming.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="algorithmic-stemmers.html">Algorithmic Stemmers</a></span></dt><dt><span class="section"><a href="dictionary-stemmers.html">Dictionary Stemmers</a></span></dt><dt><span class="section"><a href="hunspell.html">Hunspell Stemmer</a></span></dt><dt><span class="section"><a href="choosing-a-stemmer.html">Choosing a Stemmer</a></span></dt><dt><span class="section"><a href="controlling-stemming.html">Controlling Stemming</a></span></dt><dt><span class="section"><a href="stemming-in-situ.html">Stemming in situ</a></span></dt></dl></div><p>Out-of-the-box stemming solutions are never perfect.<a id="id-1.6.6.16.2.1" class="indexterm"></a>
<a id="id-1.6.6.16.2.2" class="indexterm"></a>  Algorithmic stemmers,
especially, will blithely apply their rules to any words they encounter,
perhaps conflating words that you would prefer to keep separate.  Maybe, for
your use case, it is important to keep <code class="literal">skies</code> and <code class="literal">skiing</code> as distinct words
rather than stemming them both down to <code class="literal">ski</code> (as would happen with the
<code class="literal">english</code> analyzer).</p><p>The <a class="ulink" href="http://bit.ly/1IOeXZD" target="_top"><code class="literal">keyword_marker</code></a> and
<a class="ulink" href="http://bit.ly/1ymcioJ" target="_top"><code class="literal">stemmer_override</code></a> token filters<a id="id-1.6.6.16.3.3" class="indexterm"></a><a id="id-1.6.6.16.3.4" class="indexterm"></a>
allow us to customize the stemming process.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="preventing-stemming"></a>Preventing Stemming<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/230_Stemming/50_Controlling_stemming.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <a class="link" href="configuring-language-analyzers.html#stem-exclusion"><code class="literal">stem_exclusion</code></a> parameter for language analyzers (see
<a class="xref" href="configuring-language-analyzers.html" title="Configuring Language Analyzers">Configuring Language Analyzers</a>) allowed <a id="id-1.6.6.16.4.2.3" class="indexterm"></a>
<a id="id-1.6.6.16.4.2.4" class="indexterm"></a>
<a id="id-1.6.6.16.4.2.5" class="indexterm"></a>us to specify a list of words that
should not be stemmed.  Internally, these language analyzers use the
<a class="ulink" href="http://bit.ly/1IOeXZD" target="_top"><code class="literal">keyword_marker</code> token filter</a>
to mark the listed words as <span class="emphasis"><em>keywords</em></span>, which prevents subsequent stemming
token filters from touching those words.<a id="id-1.6.6.16.4.2.8" class="indexterm"></a>
<a id="id-1.6.6.16.4.2.9" class="indexterm"></a></p><p>For instance, we can create a simple custom analyzer that uses the
<a class="ulink" href="http://bit.ly/17LseXy" target="_top"><code class="literal">porter_stem</code></a> token filter,
but prevents the word <code class="literal">skies</code> from<a id="id-1.6.6.16.4.3.3" class="indexterm"></a> being stemmed:</p><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "settings": {
    "analysis": {
      "filter": {
        "no_stem": {
          "type": "keyword_marker",
          "keywords": [ "skies" ] <a id="CO161-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        }
      },
      "analyzer": {
        "my_english": {
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "no_stem",
            "porter_stem"
          ]
        }
      }
    }
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO161-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
They <code class="literal">keywords</code> parameter could accept multiple words.
</p></td></tr></table></div><p>Testing it with the <code class="literal">analyze</code> API shows that just the word <code class="literal">skies</code> has
been excluded from stemming:</p><pre class="programlisting prettyprint lang-json">GET /my_index/_analyze?analyzer=my_english
sky skies skiing skis <a id="CO162-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO162-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Returns: <code class="literal">sky</code>, <code class="literal">skies</code>, <code class="literal">ski</code>, <code class="literal">ski</code>
</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><a id="keyword-path"></a><p>While the language analyzers allow <a id="id-1.6.6.16.4.9.1.1" class="indexterm"></a>
<a id="id-1.6.6.16.4.9.1.2" class="indexterm"></a>us only to specify an array of words in the
<code class="literal">stem_exclusion</code> parameter, the <code class="literal">keyword_marker</code> token filter also accepts a
<code class="literal">keywords_path</code> parameter that allows us to store all of our keywords in a
file. <a id="id-1.6.6.16.4.9.1.6" class="indexterm"></a>
<a id="id-1.6.6.16.4.9.1.7" class="indexterm"></a>The file should contain one word per line, and must be present on every
node in the cluster. See <a class="xref" href="using-stopwords.html#updating-stopwords" title="Updating Stopwords">Updating Stopwords</a> for tips on how to update this
file.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="customizing-stemming"></a>Customizing Stemming<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/230_Stemming/50_Controlling_stemming.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In the preceding example, we prevented <code class="literal">skies</code> from being stemmed, but perhaps we
would prefer it to be stemmed to <code class="literal">sky</code> instead.<a id="id-1.6.6.16.5.2.3" class="indexterm"></a>
<a id="id-1.6.6.16.5.2.4" class="indexterm"></a>
<a id="id-1.6.6.16.5.2.5" class="indexterm"></a>  The
<a class="ulink" href="http://bit.ly/1ymcioJ" target="_top"><code class="literal">stemmer_override</code></a> token
filter allows us <a id="id-1.6.6.16.5.2.7" class="indexterm"></a>to specify our own custom stemming rules. At the same time,
we can handle some irregular forms like stemming <code class="literal">mice</code> to <code class="literal">mouse</code> and <code class="literal">feet</code>
to <code class="literal">foot</code>:</p><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "settings": {
    "analysis": {
      "filter": {
        "custom_stem": {
          "type": "stemmer_override",
          "rules": [ <a id="CO163-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "skies=&gt;sky",
            "mice=&gt;mouse",
            "feet=&gt;foot"
          ]
        }
      },
      "analyzer": {
        "my_english": {
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "custom_stem", <a id="CO163-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            "porter_stem"
          ]
        }
      }
    }
  }
}

GET /my_index/_analyze?analyzer=my_english
The mice came down from the skies and ran over my feet <a id="CO163-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO163-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Rules take the form <code class="literal">original=&gt;stem</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO163-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">stemmer_override</code> filter must be placed before the stemmer.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO163-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Returns <code class="literal">the</code>, <code class="literal">mouse</code>, <code class="literal">came</code>, <code class="literal">down</code>, <code class="literal">from</code>, <code class="literal">the</code>, <code class="literal">sky</code>,
    <code class="literal">and</code>, <code class="literal">ran</code>, <code class="literal">over</code>, <code class="literal">my</code>, <code class="literal">foot</code>.
</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Just as for the <code class="literal">keyword_marker</code> token filter, rules can be stored
in a file whose location should be specified with the <code class="literal">rules_path</code>
parameter.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="choosing-a-stemmer.html">
              « 
              Choosing a Stemmer</a>
           
        </span><span class="next">
           
          <a href="stemming-in-situ.html">Stemming in situ
               »
            </a></span></div>
<!-- end body -->

            </section>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            <!-- Footer -->
        
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div>
<!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elasticsearch" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elasticsearch" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<div class="preloader">
    	<div class="status"></div>
	</div>
  	<style></style>
   	<link type="text/css" rel="stylesheet" href="/static/css/flexslider.css" >

<script src="/static/js/jquery.flexslider.min.js"></script>
<script src="/static/js/jquery.dropdown.min.js"></script>
<script src="/static/js/script.js"></script>
   	
</body>