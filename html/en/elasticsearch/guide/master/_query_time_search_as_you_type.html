
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Query-Time Search-as-You-Type</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide" /><link rel="up" href="partial-matching.html" title="Partial Matching" /><link rel="prev" href="_wildcard_and_regexp_queries.html" title="wildcard and regexp Queries" /><link rel="next" href="_index_time_optimizations.html" title="Index-Time Optimizations" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<!-- For third-generation iPad with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">

	<!-- For iPhone with high-resolution Retina display: -->

	<link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">

	<!-- For first- and second-generation iPad: -->

	<link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />	
	<link type="text/css" rel="stylesheet" href="/static/css/style.css" />	
	<script src="/static/js/skel.min.js"></script>
	<script type="text/javascript">form_name = "guide_template"</script>
	<script src="/static/js/init.js"></script>
	<script src="/static/js/classie.js"></script>
	

	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>

	

<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			

<div class="container">
	<div class="row">
		<div class="12u">
			<section>
				<div class="row">
					<div class="8u 6u(small) 6u(xsmall)">
						<div id="elastic">
							<h1><a href="/"></a></h1>
						</div>
						<!-- Searchbar Input box -->
						<form method="get" action="/search" name="searchForm" class="header-search-form">
						   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
						</form>
						<div class="mobile-auto-complete"></div> 
					</div>
					<div class="4u 6u(small) 6u(xsmall)">
						<!-- Mobile Menu -->
						<div class="mobile-menu-wrapper">
							<ul class="m-shortcuts">
								<li><a id="header-search" class="m-search" href="#"></a></li>
								<li><a class="m-guide" href="/guide"></a></li>
							</ul>											
							<nav class="nav-menu">
								<div class="menu-button">
									<span></span>
								</div>
								<div class="nav-menu-list-wrap">
									<div class="nav-menu-list">
										<h3><a href="/products">Products</a></h3>
										<ul>
											<li><a href="/products/elasticsearch">Elasticsearch</a></li>
											<li><a href="/products/logstash">Logstash</a></li>
											<li><a href="/products/kibana">Kibana</a></li>
											<li><a href="/products/shield">Shield</a></li>
											<li><a href="/products/marvel">Marvel</a></li>
											<li><a href="/products/hadoop">Hadoop</a></li>
											<li><a href="/subscriptions">Support</a></li>
											<li><a href="/downloads">Downloads</a></li>
										</ul>
										<h3><a href="/subscriptions">Subscriptions</a></h3>
										<h3><a href="/learn">Learn</a></h3>
										<ul>
											<li><a href="/guide">Docs</a></li>
											<li><a href="/videos">Videos</a></li>
											<li><a href="http://purchases.elasticsearch.com" target="_blank">Training</a></li>
											<li><a href="/blog">Blog</a></li>
											<li><a href="/elasticon">elastic{ON}</a></li>
										</ul>
										<h3><a href="/community">Community</a></h3>
										<ul>
											<li><a href="/community/meetups">Meetups</a></li>
										</ul>
										<h3><a href="/use-cases">Use Cases</a></h3>
										<h3><a href="/about">About</a></h3>
										<ul>
											<li><a href="/about/leadership">Leadership</a></li>
											<li><a href="/about/board">Board of Directors</a></li>
											<li><a href="/about/careers">Careers</a></li>
											<li><a href="/about/partners">Partners</a></li>
											<li><a href="/about/press">Press</a></li>
										</ul>
									</div>
								</div>
							</nav>
						</div>
						<!-- Shortcuts -->
						<nav id="shortcuts">
							<ul class="links">
								
									<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
								
									<li class="sc-docs grayscale"><a href="/guide" id="header_guide">docs</a></li>
								
									<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
								
									<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
								
							</ul>
						</nav>
					</div>
				</div>
			</section>
			

<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elastic.co" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="elastic{search}" id="autocomplete">
					<button class="button icon" onclick="searchForm.submit()">GO</button>
				</form>
			</div>
			<div class="nav-auto-complete"></div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-docs{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide</a></span> » <span class="breadcrumb-link"><a href="search-in-depth.html">Search in Depth </a></span> » <span class="breadcrumb-link"><a href="partial-matching.html">Partial Matching</a></span> » <span class="breadcrumb-node">Query-Time Search-as-You-Type</span></div><div class="navheader"><span class="prev"><a href="_wildcard_and_regexp_queries.html">
              « 
              wildcard and regexp Queries</a>
           
        </span><span class="next">
           
          <a href="_index_time_optimizations.html">Index-Time Optimizations
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_query_time_search_as_you_type"></a>Query-Time Search-as-You-Type<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/130_Partial_Matching/20_Match_phrase_prefix.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="_postcodes_and_structured_data.html">Postcodes and Structured Data</a></span></dt><dt><span class="section"><a href="prefix-query.html">prefix Query</a></span></dt><dt><span class="section"><a href="_wildcard_and_regexp_queries.html">wildcard and regexp Queries</a></span></dt><dt><span class="section"><a href="_query_time_search_as_you_type.html">Query-Time Search-as-You-Type</a></span></dt><dt><span class="section"><a href="_index_time_optimizations.html">Index-Time Optimizations</a></span></dt><dt><span class="section"><a href="_ngrams_for_partial_matching.html">Ngrams for Partial Matching</a></span></dt><dt><span class="section"><a href="_index_time_search_as_you_type.html">Index-Time Search-as-You-Type</a></span></dt><dt><span class="section"><a href="ngrams-compound-words.html">Ngrams for Compound Words</a></span></dt></dl></div><p>Leaving postcodes behind, let’s take a look at how prefix matching can help
with full-text queries. <a id="id-1.5.7.14.2.1" class="indexterm"></a>
<a id="id-1.5.7.14.2.2" class="indexterm"></a> Users have become accustomed to seeing search results
before they have finished typing their query—so-called <span class="emphasis"><em>instant search</em></span>, or
<span class="emphasis"><em>search-as-you-type</em></span>. <a id="id-1.5.7.14.2.5" class="indexterm"></a><a id="id-1.5.7.14.2.6" class="indexterm"></a> Not only do users receive their search results in less
time, but we can guide them toward results that actually exist in our index.</p><p>For instance, if a user types in <code class="literal">johnnie walker bl</code>, we would like to show results for Johnnie Walker Black Label and Johnnie Walker Blue
Label before they can finish typing their query.</p><p>As always, there are more ways than one to skin a cat! We will start by
looking at the way that is simplest to implement.  You don’t need to prepare your
data in any way; you can implement <span class="emphasis"><em>search-as-you-type</em></span> at query time on any
full-text field.</p><p>In <a class="xref" href="phrase-matching.html" title="Phrase Matching">Phrase Matching</a>, we introduced the <code class="literal">match_phrase</code> query, which matches
all the specified words in the same positions relative to each other.  For-query time search-as-you-type, we can use a specialization of this query,
called <a id="id-1.5.7.14.5.3" class="indexterm"></a>
<a id="id-1.5.7.14.5.4" class="indexterm"></a><a id="id-1.5.7.14.5.5" class="indexterm"></a>the <code class="literal">match_phrase_prefix</code> query:</p><pre class="programlisting prettyprint lang-js">{
    "match_phrase_prefix" : {
        "brand" : "johnnie walker bl"
    }
}</pre><a class="sense_widget" href="sense_widget.html?snippets/130_Partial_Matching/20_Match_phrase_prefix.json" target="sense">View in Sense</a><p>This query behaves in the same way as the <code class="literal">match_phrase</code> query, except that it
treats the last word in the query string as a prefix.  In other words, the
preceding example would look for the following:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">johnnie</code>
</li><li class="listitem">
Followed by <code class="literal">walker</code>
</li><li class="listitem">
Followed by words beginning with <code class="literal">bl</code>
</li></ul></div><p>If you were to run this query through the <code class="literal">validate-query</code> API, it would
produce this explanation:</p><pre class="literallayout">"johnnie walker bl*"</pre><p>Like the <code class="literal">match_phrase</code> query, it accepts a <code class="literal">slop</code> parameter (see <a class="xref" href="slop.html" title="Mixing It Up">Mixing It Up</a>) to
make the word order and relative positions <a id="id-1.5.7.14.12.4" class="indexterm"></a>
<a id="id-1.5.7.14.12.5" class="indexterm"></a><a id="id-1.5.7.14.12.6" class="indexterm"></a>
<a id="id-1.5.7.14.12.7" class="indexterm"></a>somewhat less rigid:</p><pre class="programlisting prettyprint lang-js">{
    "match_phrase_prefix" : {
        "brand" : {
            "query": "walker johnnie bl", <a id="CO94-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "slop":  10
        }
    }
}</pre><a class="sense_widget" href="sense_widget.html?snippets/130_Partial_Matching/20_Match_phrase_prefix.json" target="sense">View in Sense</a><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO94-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Even though the words are in the wrong order, the query still matches
    because we have set a high enough <code class="literal">slop</code> value to allow some flexibility
    in word positions.
</p></td></tr></table></div><p>However, it is always only the last word in the query string that is treated
as a prefix.</p><p>Earlier, in <a class="xref" href="prefix-query.html" title="prefix Query">prefix Query</a>, we warned about the perils of the prefix—how
<code class="literal">prefix</code> queries can be resource intensive.  The same is true in this
case.<a id="id-1.5.7.14.17.3" class="indexterm"></a>
<a id="id-1.5.7.14.17.4" class="indexterm"></a>  A prefix of <code class="literal">a</code> could match hundreds of thousands of terms. Not only
would matching on this many terms be resource intensive, but it would also not be
useful to the user.</p><p>We can limit the impact <a id="id-1.5.7.14.18.1" class="indexterm"></a>
<a id="id-1.5.7.14.18.2" class="indexterm"></a><a id="id-1.5.7.14.18.3" class="indexterm"></a>of the prefix expansion by setting <code class="literal">max_expansions</code> to
a reasonable number, such as 50:</p><pre class="programlisting prettyprint lang-js">{
    "match_phrase_prefix" : {
        "brand" : {
            "query":          "johnnie walker bl",
            "max_expansions": 50
        }
    }
}</pre><a class="sense_widget" href="sense_widget.html?snippets/130_Partial_Matching/20_Match_phrase_prefix.json" target="sense">View in Sense</a><p>The <code class="literal">max_expansions</code> parameter controls how many terms the prefix is allowed
to match.  It will find the first term starting with <code class="literal">bl</code> and keep collecting
terms (in alphabetical order) until it either runs out of terms with prefix
<code class="literal">bl</code>, or it has more terms than <code class="literal">max_expansions</code>.</p><p>Don’t forget that we have to run this query every time the user types another
character, so it needs to be fast.  If the first set of results isn’t what users are after, they’ll keep typing until they get the results that they want.</p></div><div class="navfooter"><span class="prev"><a href="_wildcard_and_regexp_queries.html">
              « 
              wildcard and regexp Queries</a>
           
        </span><span class="next">
           
          <a href="_index_time_optimizations.html">Index-Time Optimizations
               »
            </a></span></div>
<!-- end body -->

            </section>

            <!-- Footer -->
        
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elasticsearch" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script src="/static/js/script.js"></script>
   	
   		

            <script type="text/javascript">
  jQuery(function() {
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + height + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            </body>
        