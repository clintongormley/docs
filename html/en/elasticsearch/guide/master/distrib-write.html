
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Creating, Indexing, and Deleting a Document</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide" /><link rel="up" href="distributed-docs.html" title="Distributed Document Store" /><link rel="prev" href="_how_primary_and_replica_shards_interact.html" title="How Primary and Replica Shards Interact" /><link rel="next" href="distrib-read.html" title="Retrieving a Document" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<!-- For third-generation iPad with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">

	<!-- For iPhone with high-resolution Retina display: -->

	<link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">

	<!-- For first- and second-generation iPad: -->

	<link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
	<!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'> -->
	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />	
	<link type="text/css" rel="stylesheet" href="/static/css/style.css" />	
	<script src="/static/js/skel.min.js"></script>
	<script type="text/javascript">form_name = "guide_template"</script>
	<script src="/static/js/init.js"></script>
	<script src="/static/js/classie.js"></script>
	<!--<script type="text/javascript">
	    (function() {
	        var path = '//easy.myfonts.net/v2/js?sid=10336(font-family=Avenir+35+Light)&sid=10338(font-family=Avenir+55+Roman)&sid=10340(font-family=Avenir+85+Heavy)&sid=10344(font-family=Avenir+65+Medium)&key=nAD6PCOPrX',
	            protocol = ('https:' == document.location.protocol ? 'https:' : 'http:'),
	            trial = document.createElement('script');
	        trial.type = 'text/javascript';
	        trial.async = true;
	        trial.src = protocol + path;
	        var head = document.getElementsByTagName("head")[0];
	        head.appendChild(trial);
	    })();
	</script>-->

	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />
	<link rel="stylesheet" type="text/css" href="/static/css/guide_template.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>

	

<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			

<div class="container w100">
	<div class="row">
		<div class="12u">
			<section>
				<div class="row">
					<div class="8u 6u(small) 6u(xsmall)">
						<div id="elastic">
							<h1><a href="/"></a></h1>
						</div>
						<!-- Searchbar Input box -->
						<form method="get" action="/search" name="searchForm" class="header-search-form">
						   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
						</form>
						<div class="mobile-auto-complete"></div> 
					</div>
					<div class="4u 6u(small) 6u(xsmall)">
						<!-- Mobile Menu -->
						<div class="mobile-menu-wrapper">
							<ul class="m-shortcuts">
								<li><a id="header-search" class="m-search" href="#"></a></li>
								<li><a class="m-guide" href="/guide"></a></li>
								<li><a class="m-contact" href="/contact"></a></li>
							</ul>											
							<nav class="nav-menu">
								<div class="menu-button">
									<span></span>
								</div>
								<div class="nav-menu-list-wrap">
									<div class="nav-menu-list">
										<h3><a href="/products">Products</a></h3>
										<ul>
											<li><a href="/products/elasticsearch">Elasticsearch</a></li>
											<li><a href="/products/logstash">Logstash</a></li>
											<li><a href="/products/kibana">Kibana</a></li>
											<li><a href="/products/shield">Shield</a></li>
											<li><a href="/products/marvel">Marvel</a></li>
											<li><a href="/products/hadoop">Hadoop</a></li>
											<li><a href="/subscriptions">Support</a></li>
											<li><a href="/downloads">Downloads</a></li>
										</ul>
										<h3><a href="/subscriptions">Subscriptions</a></h3>
										<h3><a href="/learn">Learn</a></h3>
										<ul>
											<li><a href="/guide">Docs</a></li>
											<li><a href="/videos">Videos</a></li>
											<li><a href="https://purchases.elastic.co" target="_blank">Training</a></li>
											<li><a href="/blog">Blog</a></li>
											<li><a href="/elasticon">elastic{ON}</a></li>
										</ul>
										<h3><a href="/community">Community</a></h3>
										<ul>
											<li><a href="/community/meetups">Meetups</a></li>
										</ul>
										<h3><a href="/use-cases">Use Cases</a></h3>
										<h3><a href="/about">About</a></h3>
										<ul>
											<li><a href="/about/leadership">Leadership</a></li>
											<li><a href="/about/board">Board of Directors</a></li>
											<li><a href="/about/careers">Careers</a></li>
											<li><a href="/about/partners">Partners</a></li>
											<li><a href="/about/press">Press</a></li>
										</ul>
									</div>
								</div>
							</nav>
						</div>
						<!-- Shortcuts -->
						<nav id="shortcuts">
							<ul class="links">
								
									<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
								
									<li class="sc-docs grayscale"><a href="/guide" id="header_guide">docs</a></li>
								
									<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
								
									<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
								
							</ul>
						</nav>
					</div>
				</div>
			</section>
			

<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elastic.co" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="elastic{search}" id="autocomplete">
					<button class="button icon" onclick="searchForm.submit()">GO</button>
				</form>
			</div>
			<div class="nav-auto-complete"></div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-docs{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide</a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started </a></span> » <span class="breadcrumb-link"><a href="distributed-docs.html">Distributed Document Store</a></span> » <span class="breadcrumb-node">Creating, Indexing, and Deleting a Document</span></div><div class="navheader"><span class="prev"><a href="_how_primary_and_replica_shards_interact.html">
              « 
              How Primary and Replica Shards Interact</a>
           
        </span><span class="next">
           
          <a href="distrib-read.html">Retrieving a Document
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="distrib-write"></a>Creating, Indexing, and Deleting a Document<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/040_Distributed_CRUD/15_Create_index_delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="routing-value.html">Routing a Document to a Shard</a></span></dt><dt><span class="section"><a href="_how_primary_and_replica_shards_interact.html">How Primary and Replica Shards Interact</a></span></dt><dt><span class="section"><a href="distrib-write.html">Creating, Indexing, and Deleting a Document</a></span></dt><dt><span class="section"><a href="distrib-read.html">Retrieving a Document</a></span></dt><dt><span class="section"><a href="_partial_updates_to_a_document.html">Partial Updates to a Document</a></span></dt><dt><span class="section"><a href="distrib-multi-doc.html">Multidocument Patterns</a></span></dt></dl></div><p>Create, index, and delete<a id="id-1.4.6.7.2.1" class="indexterm"></a>
<a id="id-1.4.6.7.2.2" class="indexterm"></a> requests are <span class="emphasis"><em>write</em></span> operations,<a id="id-1.4.6.7.2.4" class="indexterm"></a> which must be
successfully completed on the primary shard before they can be copied to any
associated replica shards, as shown in <a class="xref" href="distrib-write.html#img-distrib-write" title="Figure 9. Creating, indexing, or deleting a single document">Figure 9, “Creating, indexing, or deleting a single document”</a>.</p><div class="figure"><a id="img-distrib-write"></a><p class="title"><strong>Figure 9. Creating, indexing, or deleting a single document</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_0402.png" alt="Creating, indexing or deleting a single document" /></div></div></div><br class="figure-break" /><p>Here is the sequence <a id="id-1.4.6.7.4.1" class="indexterm"></a>
<a id="id-1.4.6.7.4.2" class="indexterm"></a><a id="id-1.4.6.7.4.3" class="indexterm"></a>
<a id="id-1.4.6.7.4.4" class="indexterm"></a>of steps necessary to successfully create, index, or
delete a document on both the primary and any replica shards:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
The client sends a create, index, or delete request to <code class="literal">Node 1</code>.
</li><li class="listitem">
The node uses the document’s <code class="literal">_id</code> to determine that the document
   belongs to shard <code class="literal">0</code>. It forwards the request to <code class="literal">Node 3</code>,
   where the primary copy of shard <code class="literal">0</code> is currently allocated.
</li><li class="listitem">
<code class="literal">Node 3</code> executes the request on the primary shard. If it is successful,
   it forwards the request in parallel to the replica shards on <code class="literal">Node 1</code> and
   <code class="literal">Node 2</code>. Once all of the replica shards report success, <code class="literal">Node 3</code> reports
   success to the requesting node, which reports success to the client.
</li></ol></div><p>By the time the client receives a successful response, the document change has
been executed on the primary shard and on all replica shards. Your change is
safe.</p><p>There are a number of optional request parameters that allow you to influence
this process, possibly increasing performance at the cost of data security.
These options are seldom used because Elasticsearch is already fast, but they
are explained here for the sake of completeness:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">replication</code>
</span></dt><dd><p class="simpara">The default value for <a id="id-1.4.6.7.8.1.2.1.1" class="indexterm"></a>
<a id="id-1.4.6.7.8.1.2.1.2" class="indexterm"></a>replication is <code class="literal">sync</code>. <a id="id-1.4.6.7.8.1.2.1.4" class="indexterm"></a>This causes the primary shard to
wait for successful responses from the replica shards before returning.</p><p class="simpara">If you set <code class="literal">replication</code> to <code class="literal">async</code>,<a id="id-1.4.6.7.8.1.2.2.3" class="indexterm"></a> it will return success to the client
as soon as the request has been executed on the primary shard. It will still
forward the request to the replicas, but you will not know whether the replicas
succeeded.</p><p class="simpara">This option is mentioned specifically to advise against using it.  The default
<code class="literal">sync</code> replication allows Elasticsearch to exert back pressure on whatever
system is feeding it with data. With <code class="literal">async</code> replication, it is possible to
overload Elasticsearch by sending too many requests without waiting for their
completion.</p></dd><dt><span class="term">
<code class="literal">consistency</code>
</span></dt><dd><p class="simpara">By default, the primary shard<a id="id-1.4.6.7.8.2.2.1.1" class="indexterm"></a><a id="id-1.4.6.7.8.2.2.1.2" class="indexterm"></a> requires a <span class="emphasis"><em>quorum</em></span>, or majority, of shard copies
(where a shard copy can be a primary or a replica shard) to be available
before even attempting a write operation. This is to prevent writing data to the
“wrong side” of a network partition.  A quorum is defined as follows:</p><pre class="literallayout">int( (primary + number_of_replicas) / 2 ) + 1</pre><p class="simpara">The allowed values for <code class="literal">consistency</code> are <code class="literal">one</code> (just the primary shard), <code class="literal">all</code>
(the primary and all replicas), or the default <code class="literal">quorum</code>, or majority, of shard
copies.</p><p class="simpara">Note that the <code class="literal">number_of_replicas</code> is the number of replicas <span class="emphasis"><em>specified</em></span> in
the index settings, not the number of replicas that are currently active.  If
you have specified that an index should have three replicas, a quorum would
be as follows:</p><pre class="literallayout">int( (primary + 3 replicas) / 2 ) + 1 = 3</pre><p class="simpara">But if you start only two nodes, there will be insufficient active shard
copies to satisfy the quorum, and you will be unable to index or delete any
documents.</p></dd><dt><span class="term">
<code class="literal">timeout</code>
</span></dt><dd>
What happens if insufficient shard copies are available? Elasticsearch waits,
in the hope that more shards will appear.  By default, it will wait up to 1
minute. If you need to, you can use the <code class="literal">timeout</code> parameter<a id="id-1.4.6.7.8.3.2.1.2" class="indexterm"></a> to make it abort
sooner: <code class="literal">100</code> is 100 milliseconds, and <code class="literal">30s</code> is 30 seconds.
</dd></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>A new index has <code class="literal">1</code> replica by default, which means that two active shard
copies <span class="emphasis"><em>should</em></span> be required in order to satisfy the need for a <code class="literal">quorum</code>.
However, these default settings would prevent us from doing anything useful
with a single-node cluster.  To avoid this problem, the requirement for
a quorum is enforced only when <code class="literal">number_of_replicas</code> is greater than <code class="literal">1</code>.</p></div></div></div><div class="navfooter"><span class="prev"><a href="_how_primary_and_replica_shards_interact.html">
              « 
              How Primary and Replica Shards Interact</a>
           
        </span><span class="next">
           
          <a href="distrib-read.html">Retrieving a Document
               »
            </a></span></div>
<!-- end body -->

            </section>

            <!-- Footer -->
        
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elasticsearch" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script src="/static/js/script.js"></script>
   	
   	
   	
   	<script type="application/ld+json">
	{
	  "@context": "http://schema.org",
	  "@type": "Organization",
	  "name" : "Elastic",
	  "url": "https://www.elastic.co/",
	  "logo": "https://www.elastic.co/static/img/logo-elastic.png",
	  "potentialAction": {
	    "@type": "SearchAction",
	    "target": "https://www.elastic.co/search?q={query_string}",
	    "query-input": "required name=query_string"
	  }
	}
</script>	

            <script type="text/javascript">
  jQuery(function() {
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + (10 + height) + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            </body>
        