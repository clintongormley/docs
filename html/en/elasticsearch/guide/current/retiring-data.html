
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Retiring Data</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide" /><link rel="up" href="scale.html" title="Designing for Scale" /><link rel="prev" href="index-templates.html" title="Index Templates" /><link rel="next" href="user-based.html" title="User-Based Data" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<!-- For third-generation iPad with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">

	<!-- For iPhone with high-resolution Retina display: -->

	<link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">

	<!-- For first- and second-generation iPad: -->

	<link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />	
	<link type="text/css" rel="stylesheet" href="/static/css/style.css" />	
	<script src="/static/js/skel.min.js"></script>
	<script type="text/javascript">form_name = "guide_template"</script>
	<script src="/static/js/init.js"></script>
	<script src="/static/js/classie.js"></script>
	

	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>

	

<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			

<div class="container">
	<div class="row">
		<div class="12u">
			<section>
				<div class="row">
					<div class="8u 6u(small) 6u(xsmall)">
						<div id="elastic">
							<h1><a href="/"></a></h1>
						</div>
						<!-- Searchbar Input box -->
						<form method="get" action="/search" name="searchForm" class="header-search-form">
						   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
						</form>
						<div class="mobile-auto-complete"></div> 
					</div>
					<div class="4u 6u(small) 6u(xsmall)">
						<!-- Mobile Menu -->
						<div class="mobile-menu-wrapper">
							<ul class="m-shortcuts">
								<li><a id="header-search" class="m-search" href="#"></a></li>
								<li><a class="m-guide" href="/guide"></a></li>
							</ul>											
							<nav class="nav-menu">
								<div class="menu-button">
									<span></span>
								</div>
								<div class="nav-menu-list-wrap">
									<div class="nav-menu-list">
										<h3><a href="/products">Products</a></h3>
										<ul>
											<li><a href="/products/elasticsearch">Elasticsearch</a></li>
											<li><a href="/products/logstash">Logstash</a></li>
											<li><a href="/products/kibana">Kibana</a></li>
											<li><a href="/products/shield">Shield</a></li>
											<li><a href="/products/marvel">Marvel</a></li>
											<li><a href="/products/hadoop">Hadoop</a></li>
											<li><a href="/subscriptions">Support</a></li>
											<li><a href="/downloads">Downloads</a></li>
										</ul>
										<h3><a href="/subscriptions">Subscriptions</a></h3>
										<h3><a href="/learn">Learn</a></h3>
										<ul>
											<li><a href="/guide">Docs</a></li>
											<li><a href="/videos">Videos</a></li>
											<li><a href="http://purchases.elasticsearch.com" target="_blank">Training</a></li>
											<li><a href="/blog">Blog</a></li>
											<li><a href="/elasticon">elastic{ON}</a></li>
										</ul>
										<h3><a href="/community">Community</a></h3>
										<ul>
											<li><a href="/community/meetups">Meetups</a></li>
										</ul>
										<h3><a href="/use-cases">Use Cases</a></h3>
										<h3><a href="/about">About</a></h3>
										<ul>
											<li><a href="/about/leadership">Leadership</a></li>
											<li><a href="/about/board">Board of Directors</a></li>
											<li><a href="/about/careers">Careers</a></li>
											<li><a href="/about/partners">Partners</a></li>
											<li><a href="/about/press">Press</a></li>
										</ul>
									</div>
								</div>
							</nav>
						</div>
						<!-- Shortcuts -->
						<nav id="shortcuts">
							<ul class="links">
								
									<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
								
									<li class="sc-docs grayscale"><a href="/guide" id="header_guide">docs</a></li>
								
									<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
								
									<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
								
							</ul>
						</nav>
					</div>
				</div>
			</section>
			

<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elastic.co" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="elastic{search}" id="autocomplete">
					<button class="button icon" onclick="searchForm.submit()">GO</button>
				</form>
			</div>
			<div class="nav-auto-complete"></div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-docs{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide</a></span> » <span class="breadcrumb-link"><a href="modeling-your-data.html">Modeling Your Data </a></span> » <span class="breadcrumb-link"><a href="scale.html">Designing for Scale</a></span> » <span class="breadcrumb-node">Retiring Data</span></div><div class="navheader"><span class="prev"><a href="index-templates.html">
              « 
              Index Templates</a>
           
        </span><span class="next">
           
          <a href="user-based.html">User-Based Data
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="retiring-data"></a>Retiring Data<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/410_Scaling/55_Retiring_data.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="shard-scale.html">The Unit of Scale</a></span></dt><dt><span class="section"><a href="overallocation.html">Shard Overallocation</a></span></dt><dt><span class="section"><a href="kagillion-shards.html">Kagillion Shards</a></span></dt><dt><span class="section"><a href="capacity-planning.html">Capacity Planning</a></span></dt><dt><span class="section"><a href="replica-shards.html">Replica Shards</a></span></dt><dt><span class="section"><a href="multiple-indices.html">Multiple Indices</a></span></dt><dt><span class="section"><a href="time-based.html">Time-Based Data</a></span></dt><dt><span class="section"><a href="index-templates.html">Index Templates</a></span></dt><dt><span class="section"><a href="retiring-data.html">Retiring Data</a></span></dt><dt><span class="section"><a href="user-based.html">User-Based Data</a></span></dt><dt><span class="section"><a href="shared-index.html">Shared Index</a></span></dt><dt><span class="section"><a href="faking-it.html">Faking Index per User with Aliases</a></span></dt><dt><span class="section"><a href="one-big-user.html">One Big User</a></span></dt><dt><span class="section"><a href="finite-scale.html">Scale Is Not Infinite</a></span></dt></dl></div><p>As time-based data ages, it becomes less relevant.<a id="id-1.9.6.15.2.1" class="indexterm"></a>
<a id="id-1.9.6.15.2.2" class="indexterm"></a>  It’s possible that we
will want to see what happened last week, last month, or even last year, but
for the most part, we’re interested in only the here and now.</p><p>The nice thing about an index per time frame <a id="id-1.9.6.15.3.1" class="indexterm"></a>
<a id="id-1.9.6.15.3.2" class="indexterm"></a>
<a id="id-1.9.6.15.3.3" class="indexterm"></a><a id="id-1.9.6.15.3.4" class="indexterm"></a>
<a id="id-1.9.6.15.3.5" class="indexterm"></a>is that it enables us to easily
delete old data: just delete the indices that are no longer relevant:</p><pre class="programlisting prettyprint lang-json">DELETE /logs_2013*</pre><p>Deleting a whole index is much more efficient than deleting individual
documents: Elasticsearch just removes whole directories.</p><p>But deleting an index is very <span class="emphasis"><em>final</em></span>.  There are a number of things we can
do to help data age gracefully, before we decide to delete it completely.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="migrate-indices"></a>Migrate Old Indices<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/410_Scaling/55_Retiring_data.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>With logging data, there is likely to be one <span class="emphasis"><em>hot</em></span> index—the index for
today.<a id="id-1.9.6.15.7.2.2" class="indexterm"></a>
<a id="id-1.9.6.15.7.2.3" class="indexterm"></a>  All new documents will be added to that index, and almost all queries
will target that index.  It should use your best hardware.</p><p>How does Elasticsearch know which servers are your best servers? You tell it,
by assigning arbitrary tags to each server.  For instance, you could start a
node as follows:</p><pre class="literallayout">./bin/elasticsearch --node.box_type strong</pre><p>The <code class="literal">box_type</code> parameter is completely arbitrary—you could have named it
whatever you like—but you can use these arbitrary values to tell
Elasticsearch where to allocate an index.</p><p>We can ensure that today’s index is on our strongest boxes by creating it with
the following settings:</p><pre class="programlisting prettyprint lang-json">PUT /logs_2014-10-01
{
  "settings": {
    "index.routing.allocation.include.box_type" : "strong"
  }
}</pre><p>Yesterday’s index no longer needs to be on our strongest boxes, so we can move
it to the nodes tagged as <code class="literal">medium</code> by updating its index settings:</p><pre class="programlisting prettyprint lang-json">POST /logs_2014-09-30/_settings
{
  "index.routing.allocation.include.box_type" : "medium"
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="optimize-indices"></a>Optimize Indices<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/410_Scaling/55_Retiring_data.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Yesterday’s index is unlikely to change.<a id="id-1.9.6.15.8.2.1" class="indexterm"></a>
<a id="id-1.9.6.15.8.2.2" class="indexterm"></a>  Log events are static: what
happened in the past stays in the past.  If we merge each shard down to just a
single segment, it’ll use fewer resources and will be quicker to query. We
can do this with the <a class="xref" href="merge-process.html#optimize-api" title="optimize API">optimize API</a>.</p><p>It would be a bad idea to optimize the index while it was still allocated to
the <code class="literal">strong</code> boxes, as the optimization process could swamp the I/O on those
nodes and impact the indexing of today’s logs.  But the <code class="literal">medium</code> boxes aren’t
doing very much at all, so we are safe to optimize.</p><p>Yesterday’s index may have replica shards.<a id="id-1.9.6.15.8.4.1" class="indexterm"></a>
<a id="id-1.9.6.15.8.4.2" class="indexterm"></a> If we issue an optimize request, it
will optimize the primary shard and the replica shards, which is a waste.
Instead, we can remove the replicas temporarily, optimize, and then restore the
replicas:</p><pre class="programlisting prettyprint lang-json">POST /logs_2014-09-30/_settings
{ "number_of_replicas": 0 }

POST /logs_2014-09-30/_optimize?max_num_segments=1

POST /logs_2014-09-30/_settings
{ "number_of_replicas": 1 }</pre><p>Of course, without replicas, we run the risk of losing data if a disk suffers
catastrophic failure.  You may<a id="id-1.9.6.15.8.6.1" class="indexterm"></a> want to back up the data first, with the
<a class="ulink" href="http://bit.ly/14ED13A" target="_top"><code class="literal">snapshot-restore</code> API</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="close-indices"></a>Closing Old Indices<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/410_Scaling/55_Retiring_data.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>As indices get even older, they reach a point where they are almost never
accessed.<a id="id-1.9.6.15.9.2.1" class="indexterm"></a>
<a id="id-1.9.6.15.9.2.2" class="indexterm"></a>  We could delete them at this stage, but perhaps you want to keep
them around just in case somebody asks for them in six months.</p><p>These indices can be closed. They will still exist in the cluster, but they
won’t consume resources other than disk space.  Reopening an index is much
quicker than restoring it from backup.</p><p>Before closing, it is worth flushing the index to make sure that there are no
transactions left in the transaction log.  An empty transaction log will make
index recovery faster when it is reopened:</p><pre class="programlisting prettyprint lang-json">POST /logs_2014-01-*/_flush <a id="CO299-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
POST /logs_2014-01-*/_close <a id="CO299-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
POST /logs_2014-01-*/_open <a id="CO299-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO299-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Flush all indices from January to empty the transaction logs.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO299-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Close all indices from January.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO299-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
When you need access to them again, reopen them with the <code class="literal">open</code> API.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="archive-indices"></a>Archiving Old Indices<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/410_Scaling/55_Retiring_data.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Finally, very old indices <a id="id-1.9.6.15.10.2.1" class="indexterm"></a>
<a id="id-1.9.6.15.10.2.2" class="indexterm"></a>can be archived off to some long-term storage like a
shared disk or Amazon’s S3 using the
<a class="ulink" href="http://bit.ly/14ED13A" target="_top"><code class="literal">snapshot-restore</code> API</a>, just in case you may need
to access them in the future.  Once a backup exists, the index can be deleted
from the cluster.</p></div></div><div class="navfooter"><span class="prev"><a href="index-templates.html">
              « 
              Index Templates</a>
           
        </span><span class="next">
           
          <a href="user-based.html">User-Based Data
               »
            </a></span></div>
<!-- end body -->

            </section>

            <!-- Footer -->
        
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elasticsearch" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script src="/static/js/script.js"></script>
   	
   		

            <script type="text/javascript">
  jQuery(function() {
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + height + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            </body>
        