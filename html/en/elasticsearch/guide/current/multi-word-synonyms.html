
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Multiword Synonyms and Phrase Queries</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide" /><link rel="up" href="synonyms.html" title="Synonyms" /><link rel="prev" href="synonyms-analysis-chain.html" title="Synonyms and The Analysis Chain" /><link rel="next" href="symbol-synonyms.html" title="Symbol Synonyms" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<!-- For third-generation iPad with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">

	<!-- For iPhone with high-resolution Retina display: -->

	<link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">

	<!-- For first- and second-generation iPad: -->

	<link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />	
	<link type="text/css" rel="stylesheet" href="/static/css/style.css" />	
	<script src="/static/js/skel.min.js"></script>
	<script type="text/javascript">form_name = "guide_template"</script>
	<script src="/static/js/init.js"></script>
	<script src="/static/js/classie.js"></script>
	

	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>

	

<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			

<div class="container">
	<div class="row">
		<div class="12u">
			<section>
				<div class="row">
					<div class="8u 6u(small) 6u(xsmall)">
						<div id="elastic">
							<h1><a href="/"></a></h1>
						</div>
						<!-- Searchbar Input box -->
						<form method="get" action="/search" name="searchForm" class="header-search-form">
						   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
						</form>
						<div class="mobile-auto-complete"></div> 
					</div>
					<div class="4u 6u(small) 6u(xsmall)">
						<!-- Mobile Menu -->
						<div class="mobile-menu-wrapper">
							<ul class="m-shortcuts">
								<li><a id="header-search" class="m-search" href="#"></a></li>
								<li><a class="m-guide" href="/guide"></a></li>
							</ul>											
							<nav class="nav-menu">
								<div class="menu-button">
									<span></span>
								</div>
								<div class="nav-menu-list-wrap">
									<div class="nav-menu-list">
										<h3><a href="/products">Products</a></h3>
										<ul>
											<li><a href="/products/elasticsearch">Elasticsearch</a></li>
											<li><a href="/products/logstash">Logstash</a></li>
											<li><a href="/products/kibana">Kibana</a></li>
											<li><a href="/products/shield">Shield</a></li>
											<li><a href="/products/marvel">Marvel</a></li>
											<li><a href="/products/hadoop">Hadoop</a></li>
											<li><a href="/subscriptions">Support</a></li>
											<li><a href="/downloads">Downloads</a></li>
										</ul>
										<h3><a href="/subscriptions">Subscriptions</a></h3>
										<h3><a href="/learn">Learn</a></h3>
										<ul>
											<li><a href="/guide">Docs</a></li>
											<li><a href="/videos">Videos</a></li>
											<li><a href="http://purchases.elasticsearch.com" target="_blank">Training</a></li>
											<li><a href="/blog">Blog</a></li>
											<li><a href="/elasticon">elastic{ON}</a></li>
										</ul>
										<h3><a href="/community">Community</a></h3>
										<ul>
											<li><a href="/community/meetups">Meetups</a></li>
										</ul>
										<h3><a href="/use-cases">Use Cases</a></h3>
										<h3><a href="/about">About</a></h3>
										<ul>
											<li><a href="/about/leadership">Leadership</a></li>
											<li><a href="/about/board">Board of Directors</a></li>
											<li><a href="/about/careers">Careers</a></li>
											<li><a href="/about/partners">Partners</a></li>
											<li><a href="/about/press">Press</a></li>
										</ul>
									</div>
								</div>
							</nav>
						</div>
						<!-- Shortcuts -->
						<nav id="shortcuts">
							<ul class="links">
								
									<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
								
									<li class="sc-docs grayscale"><a href="/guide" id="header_guide">docs</a></li>
								
									<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
								
									<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
								
							</ul>
						</nav>
					</div>
				</div>
			</section>
			

<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elastic.co" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="elastic{search}" id="autocomplete">
					<button class="button icon" onclick="searchForm.submit()">GO</button>
				</form>
			</div>
			<div class="nav-auto-complete"></div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-docs{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide</a></span> » <span class="breadcrumb-link"><a href="languages.html">Dealing with Human Language </a></span> » <span class="breadcrumb-link"><a href="synonyms.html">Synonyms</a></span> » <span class="breadcrumb-node">Multiword Synonyms and Phrase Queries</span></div><div class="navheader"><span class="prev"><a href="synonyms-analysis-chain.html">
              « 
              Synonyms and The Analysis Chain</a>
           
        </span><span class="next">
           
          <a href="symbol-synonyms.html">Symbol Synonyms
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="multi-word-synonyms"></a>Multiword Synonyms and Phrase Queries<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/260_Synonyms/60_Multi_word_synonyms.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="using-synonyms.html">Using Synonyms</a></span></dt><dt><span class="section"><a href="synonym-formats.html">Formatting Synonyms</a></span></dt><dt><span class="section"><a href="synonyms-expand-or-contract.html">Expand or contract</a></span></dt><dt><span class="section"><a href="synonyms-analysis-chain.html">Synonyms and The Analysis Chain</a></span></dt><dt><span class="section"><a href="multi-word-synonyms.html">Multiword Synonyms and Phrase Queries</a></span></dt><dt><span class="section"><a href="symbol-synonyms.html">Symbol Synonyms</a></span></dt></dl></div><p>So far, synonyms appear to be quite straightforward. Unfortunately, this is
where things start to go wrong.<a id="id-1.6.8.13.2.1" class="indexterm"></a>
<a id="id-1.6.8.13.2.2" class="indexterm"></a><a id="id-1.6.8.13.2.3" class="indexterm"></a>
<a id="id-1.6.8.13.2.4" class="indexterm"></a> For <a class="link" href="phrase-matching.html" title="Phrase Matching">phrase queries</a> to
function correctly, Elasticsearch needs to know the position that each term
occupies in the original text. Multiword synonyms can play havoc with term
positions, especially when the injected synonyms are of differing lengths.</p><p>To demonstrate, we’ll create a synonym token filter that uses this rule:</p><pre class="literallayout">"usa,united states,u s a,united states of america"</pre><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "settings": {
    "analysis": {
      "filter": {
        "my_synonym_filter": {
          "type": "synonym",
          "synonyms": [
            "usa,united states,u s a,united states of america"
          ]
        }
      },
      "analyzer": {
        "my_synonyms": {
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "my_synonym_filter"
          ]
        }
      }
    }
  }
}

GET /my_index/_analyze?analyzer=my_synonyms&amp;text=
The United States is wealthy</pre><p>The tokens emitted by the <code class="literal">analyze</code> request look like this:</p><pre class="programlisting prettyprint lang-text">Pos 1:  (the)
Pos 2:  (usa,united,u,united)
Pos 3:  (states,s,states)
Pos 4:  (is,a,of)
Pos 5:  (wealthy,america)</pre><p>If we were to index a document analyzed with synonyms as above, and then run a
phrase query without synonyms, we’d have some surprising results.  These
phrases would not match:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The usa is wealthy
</li><li class="listitem">
The united states of america is wealthy
</li><li class="listitem">
The U.S.A. is wealthy
</li></ul></div><p>However, these phrases would:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
United states is wealthy
</li><li class="listitem">
Usa states of wealthy
</li><li class="listitem">
The U.S. of wealthy
</li><li class="listitem">
U.S. is america
</li></ul></div><p>If we were to use synonyms at query time instead, we would see even more-bizarre matches. Look at the output of this <code class="literal">validate-query</code> request:</p><pre class="programlisting prettyprint lang-json">GET /my_index/_validate/query?explain
{
  "query": {
    "match_phrase": {
      "text": {
        "query": "usa is wealthy",
        "analyzer": "my_synonyms"
      }
    }
  }
}</pre><p>The explanation is as follows:</p><pre class="literallayout">"(usa united u united) (is states s states) (wealthy a of) america"</pre><p>This would match documents containg <code class="literal">u is of america</code> but wouldn’t match any
document that didn’t contain the term <code class="literal">america</code>.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Multiword synonyms <a id="id-1.6.8.13.17.1.1" class="indexterm"></a>
<a id="id-1.6.8.13.17.1.2" class="indexterm"></a>affect highlighting in a similar way.  A query for <code class="literal">USA</code>
could end up returning a highlighted snippet such as: “The <span class="emphasis"><em>United States
is wealthy</em></span>”.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_use_simple_contraction_for_phrase_queries"></a>Use Simple Contraction for Phrase Queries<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/260_Synonyms/60_Multi_word_synonyms.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The way to avoid this mess is to use <a class="link" href="synonyms-expand-or-contract.html#synonyms-contraction" title="Simple Contraction">simple contraction</a>
to inject a single<a id="id-1.6.8.13.18.2.2" class="indexterm"></a>
<a id="id-1.6.8.13.18.2.3" class="indexterm"></a>
<a id="id-1.6.8.13.18.2.4" class="indexterm"></a><a id="id-1.6.8.13.18.2.5" class="indexterm"></a>
<a id="id-1.6.8.13.18.2.6" class="indexterm"></a>
<a id="id-1.6.8.13.18.2.7" class="indexterm"></a><a id="id-1.6.8.13.18.2.8" class="indexterm"></a>
<a id="id-1.6.8.13.18.2.9" class="indexterm"></a> term that represents all synonyms, and to use the same
synonym token filter at query time:</p><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "settings": {
    "analysis": {
      "filter": {
        "my_synonym_filter": {
          "type": "synonym",
          "synonyms": [
            "united states,u s a,united states of america=&gt;usa"
          ]
        }
      },
      "analyzer": {
        "my_synonyms": {
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "my_synonym_filter"
          ]
        }
      }
    }
  }
}

GET /my_index/_analyze?analyzer=my_synonyms
The United States is wealthy</pre><p>The result of the preceding <code class="literal">analyze</code> request looks much more sane:</p><pre class="programlisting prettyprint lang-text">Pos 1:  (the)
Pos 2:  (usa)
Pos 3:  (is)
Pos 5:  (wealthy)</pre><p>And repeating the <code class="literal">validate-query</code> request that we made previously yields a simple,
sane explanation:</p><pre class="literallayout">"usa is wealthy"</pre><p>The downside of this approach is that, by reducing <code class="literal">united states of america</code>
down to the single term <code class="literal">usa</code>, you can’t use the same field to find just the
word <code class="literal">united</code> or <code class="literal">states</code>. You would need to use a separate field with a
different analysis chain for that purpose.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_synonyms_and_the_query_string_query"></a>Synonyms and the query_string Query<a href="https://github.com/elasticsearch/elasticsearch-definitive-guide/edit/master/260_Synonyms/60_Multi_word_synonyms.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>We have tried to avoid discussing the <code class="literal">query_string</code> query <a id="id-1.6.8.13.19.2.2" class="indexterm"></a>
<a id="id-1.6.8.13.19.2.3" class="indexterm"></a><a id="id-1.6.8.13.19.2.4" class="indexterm"></a>
<a id="id-1.6.8.13.19.2.5" class="indexterm"></a>because we don’t
recommend using it.  In <a class="link" href="search-lite.html#query-string-query" title="More Complicated Queries">"More-Complicated Queries"</a>, we said that, because the
<code class="literal">query_string</code> query supports a terse mini <span class="emphasis"><em>search-syntax</em></span>, it could
frequently lead to surprising results or even syntax errors.</p><p>One of the gotchas of this query involves multiword synonyms. To
support its search-syntax, it has to parse the query string to recognize
special operators like <code class="literal">AND</code>, <code class="literal">OR</code>, <code class="literal">+</code>, <code class="literal">-</code>, <code class="literal">field:</code>, and so forth.  (See the full
<a class="ulink" href="http://bit.ly/151G5I1" target="_top"><code class="literal">query_string</code> syntax</a>
here.)</p><p>As part of this parsing process, it breaks up the query string on whitespace,
and passes each word that it finds to the relevant analyzer separately. This
means that your synonym analyzer will never receive a multiword synonym.
Instead of seeing <code class="literal">United States</code> as a single string, the analyzer will
receive <code class="literal">United</code> and <code class="literal">States</code> separately.</p><p>Fortunately, the trustworthy <code class="literal">match</code> query supports no such syntax, and
multiword synonyms will be passed to the analyzer in their entirety.</p></div></div><div class="navfooter"><span class="prev"><a href="synonyms-analysis-chain.html">
              « 
              Synonyms and The Analysis Chain</a>
           
        </span><span class="next">
           
          <a href="symbol-synonyms.html">Symbol Synonyms
               »
            </a></span></div>
<!-- end body -->

            </section>

            <!-- Footer -->
        
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elasticsearch" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script src="/static/js/script.js"></script>
   	
   		

            <script type="text/javascript">
  jQuery(function() {
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + height + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            </body>
        