
<!DOCTYPE HTML>
<html lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Moving Average Aggregation</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference [master]" /><link rel="up" href="search-aggregations.html" title="Aggregations" /><link rel="prev" href="search-aggregations-reducer-min-bucket-aggregation.html" title="Max Bucket Aggregation" /><link rel="next" href="_prediction.html" title="Prediction" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<link type="text/css" rel="stylesheet" href="/static/css/en-us.css" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<!-- For third-generation iPad with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">

	<!-- For iPhone with high-resolution Retina display: -->

	<link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">

	<!-- For first- and second-generation iPad: -->

	<link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
	<!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'> -->
	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />	
	<link type="text/css" rel="stylesheet" href="/static/css/style.css" />	
	<script src="/static/js/skel.min.js"></script>
	<script type="text/javascript">form_name = "guide_template"</script>
	<script src="/static/js/init.js"></script>
	<script src="/static/js/classie.js"></script>
	<!--<script type="text/javascript">
	    (function() {
	        var path = '//easy.myfonts.net/v2/js?sid=10336(font-family=Avenir+35+Light)&sid=10338(font-family=Avenir+55+Roman)&sid=10340(font-family=Avenir+85+Heavy)&sid=10344(font-family=Avenir+65+Medium)&key=nAD6PCOPrX',
	            protocol = ('https:' == document.location.protocol ? 'https:' : 'http:'),
	            trial = document.createElement('script');
	        trial.type = 'text/javascript';
	        trial.async = true;
	        trial.src = protocol + path;
	        var head = document.getElementsByTagName("head")[0];
	        head.appendChild(trial);
	    })();
	</script>-->

	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />
	<link rel="stylesheet" type="text/css" href="/static/css/guide_template.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>

	

<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			


<div class="container w100">
	<div class="row">
		<div class="12u">
			

<section>
	<div class="row">
		<div class="8u 6u(small) 6u(xsmall)">
			<div id="elastic">
				<h1><a href="/"></a></h1>
			</div>
			<!-- Searchbar Input box -->
			<form method="get" action="/search" name="searchForm" class="header-search-form">
			   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
			</form>
			<div class="mobile-auto-complete"></div> 
		</div>
		<div class="4u 6u(small) 6u(xsmall)">
			<!-- Mobile Menu -->
			<div class="mobile-menu-wrapper">
				<ul class="m-shortcuts">
					
					<li><a href="#" class="m-search" id="header-search"></a></li>
					
					<li><a href="/guide" class="m-guide" id=""></a></li>
					
					<li><a href="/contact" class="m-contact" id=""></a></li>
					
				</ul>											
				<nav class="nav-menu">
					<div class="menu-button">
						<span></span>
					</div>
					<div class="nav-menu-list-wrap">
						<div class="nav-menu-list">
							
								<h3><a href="/products" id="nav_products" >PRODUCTS</a></h3>

								
								<ul>
									
									<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>
									
									<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>
									
									<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>
									
									<li><a href="/products/shield" id="nav_shield" >shield</a></li>
									
									<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>
									
									<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>
									
									<li><a href="/subscriptions" id="nav_support" >support</a></li>
									
									<li><a href="/downloads" id="nav_downloads" >downloads</a></li>
									
								</ul>
								
							
								<h3><a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a></h3>

								
							
								<h3><a href="/learn" id="nav_learn" >LEARN</a></h3>

								
								<ul>
									
									<li><a href="/guide" id="nav_guide" >docs</a></li>
									
									<li><a href="/videos" id="nav_videos" >videos</a></li>
									
									<li><a href="http://purchases.elastic.co" id="nav_training" >training</a></li>
									
									<li><a href="/blog" id="nav_learn_blog" >blog</a></li>
									
									<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>
									
								</ul>
								
							
								<h3><a href="/community" id="nav_community" >COMMUNITY</a></h3>

								
								<ul>
									
									<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>
									
								</ul>
								
							
								<h3><a href="/use-cases" id="nav_usecases" >USE CASES</a></h3>

								
							
								<h3><a href="/blog" id="nav_blog" >BLOG</a></h3>

								
							
								<h3><a href="/about" id="nav_about" >ABOUT</a></h3>

								
								<ul>
									
									<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>
									
									<li><a href="/about/board" id="nav_board" >board of directors</a></li>
									
									<li><a href="/about/careers" id="nav_careers" >careers</a></li>
									
									<li><a href="/about/partners" id="nav_partners" >partners</a></li>
									
									<li><a href="/about/press" id="nav_press" >press</a></li>
									
								</ul>
								
							
						</div>
					</div>
				</nav>
			</div>
			<!-- Shortcuts -->
			<nav id="shortcuts">
				<ul class="links">
					
						<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
					
						<li class="sc-docs grayscale"><a href="/guide" id="header_guide">docs</a></li>
					
						<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
					
						<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
					
				</ul>
			</nav>
		</div>
	</div>
</section>


<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elastic.co" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="elastic{search}" id="autocomplete">
					<button class="button icon" onclick="searchForm.submit()">GO</button>
				</form>
			</div>
			<div class="nav-auto-complete"></div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-docs{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	

	
		.m-shortcuts li a.m-search {
			background: url("/assets/blt174b13be89ff803c/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
	
		.m-shortcuts li a.m-guide {
			background: url("/assets/blt5ba03f594a7d610a/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
	
		.m-shortcuts li a.m-contact {
			background: url("/assets/blt38c3e853c4b1174d/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs </a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Moving Average Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-reducer-min-bucket-aggregation.html">
              « 
              Max Bucket Aggregation</a>
           
        </span><span class="next">
           
          <a href="_prediction.html">Prediction
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-reducers-movavg-reducer"></a>Moving Average Aggregation<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/aggregations/reducer/movavg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="search-aggregations-metrics-min-aggregation.html">Min Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-max-aggregation.html">Max Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-sum-aggregation.html">Sum Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-avg-aggregation.html">Avg Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-stats-aggregation.html">Stats Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-extendedstats-aggregation.html">Extended Stats Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-valuecount-aggregation.html">Value Count Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-percentile-aggregation.html">Percentiles Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-percentile-rank-aggregation.html">Percentile Ranks Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-cardinality-aggregation.html">Cardinality Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-geobounds-aggregation.html">Geo Bounds Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-top-hits-aggregation.html">Top hits Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-metrics-scripted-metric-aggregation.html">Scripted Metric Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-global-aggregation.html">Global Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-filter-aggregation.html">Filter Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-filters-aggregation.html">Filters Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-missing-aggregation.html">Missing Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-nested-aggregation.html">Nested Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-reverse-nested-aggregation.html">Reverse nested Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-children-aggregation.html">Children Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-terms-aggregation.html">Terms Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-significantterms-aggregation.html">Significant Terms Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-range-aggregation.html">Range Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-daterange-aggregation.html">Date Range Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-iprange-aggregation.html">IPv4 Range Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-histogram-aggregation.html">Histogram Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-datehistogram-aggregation.html">Date Histogram Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-geodistance-aggregation.html">Geo Distance Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-bucket-geohashgrid-aggregation.html">GeoHash grid Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-reducer-derivative-aggregation.html">Derivative Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-reducer-max-bucket-aggregation.html">Max Bucket Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-reducer-min-bucket-aggregation.html">Max Bucket Aggregation</a></span></dt><dt><span class="section"><a href="search-aggregations-reducers-movavg-reducer.html">Moving Average Aggregation</a></span></dt><dt><span class="section"><a href="_prediction.html">Prediction</a></span></dt></dl></div><p>Given an ordered series of data, the Moving Average aggregation will slide a window across the data and emit the average
value of that window.  For example, given the data <code class="literal">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</code>, we can calculate a simple moving
average with windows size of <code class="literal">5</code> as follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
(1 + 2 + 3 + 4 + 5) / 5  = 3
</li><li class="listitem">
(2 + 3 + 4 + 5 + 6) / 5  = 4
</li><li class="listitem">
(3 + 4 + 5 + 6 + 7) / 5 = 5
</li><li class="listitem">
etc
</li></ul></div><p>Moving averages are a simple method to smooth sequential data.  Moving averages are typically applied to time-based data,
such as stock prices or server metrics.  The smoothing can be used to eliminate high frequency fluctuations or random noise,
which allows the lower frequency trends to be more easily visualized, such as seasonality.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_syntax"></a>Syntax<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/aggregations/reducer/movavg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>A <code class="literal">moving_avg</code> aggregation looks like this in isolation:</p><pre class="programlisting prettyprint lang-js">{
    "movavg": {
        "buckets_path": "the_sum",
        "model": "double_exp",
        "window": 5,
        "gap_policy": "insert_zero",
        "settings": {
            "alpha": 0.8
        }
    }
}</pre><div class="table"><a id="id-1.7.8.79.5.4"></a><p class="title"><strong>Table 1. <code class="literal">moving_avg</code> Parameters</strong></p><div class="table-contents"><table summary="moving_avg Parameters" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><tbody><tr><td align="left" valign="top"><p>Parameter Name</p></td><td align="left" valign="top"><p>Description</p></td><td align="left" valign="top"><p>Required</p></td><td align="left" valign="top"><p>Default</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">buckets_path</code></p></td><td align="left" valign="top"><p>The path to the metric that we wish to calculate a moving average for</p></td><td align="left" valign="top"><p>Required</p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">model</code></p></td><td align="left" valign="top"><p>The moving average weighting model that we wish to use</p></td><td align="left" valign="top"><p>Optional</p></td><td align="left" valign="top"><p><code class="literal">simple</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">gap_policy</code></p></td><td align="left" valign="top"><p>Determines what should happen when a gap in the data is encountered.</p></td><td align="left" valign="top"><p>Optional</p></td><td align="left" valign="top"><p><code class="literal">insert_zero</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">window</code></p></td><td align="left" valign="top"><p>The size of window to "slide" across the histogram.</p></td><td align="left" valign="top"><p>Optional</p></td><td align="left" valign="top"><p><code class="literal">5</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">settings</code></p></td><td align="left" valign="top"><p>Model-specific settings, contents which differ depending on the model specified.</p></td><td align="left" valign="top"><p>Optional</p></td><td align="left" valign="top"><p></p></td></tr></tbody></table></div></div><br class="table-break" /><p><code class="literal">moving_avg</code> aggregations must be embedded inside of a <code class="literal">histogram</code> or <code class="literal">date_histogram</code> aggregation.  They can be
embedded like any other metric aggregation:</p><pre class="programlisting prettyprint lang-js">{
    "my_date_histo":{                <a id="CO48-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "date_histogram":{
            "field":"timestamp",
            "interval":"day",
            "min_doc_count": 0      <a id="CO48-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        },
        "aggs":{
            "the_sum":{
                "sum":{ "field": "lemmings" } <a id="CO48-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
            },
            "the_movavg":{
                "moving_avg":{ "buckets_path": "the_sum" } <a id="CO48-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO48-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A <code class="literal">date_histogram</code> named "my_date_histo" is constructed on the "timestamp" field, with one-day intervals
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO48-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We must specify "min_doc_count: 0" in our date histogram that all buckets are returned, even if they are empty.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO48-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A <code class="literal">sum</code> metric is used to calculate the sum of a field.  This could be any metric (sum, min, max, etc)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO48-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Finally, we specify a <code class="literal">moving_avg</code> aggregation which uses "the_sum" metric as its input.
</p></td></tr></table></div><p>Moving averages are built by first specifying a <code class="literal">histogram</code> or <code class="literal">date_histogram</code> over a field.  You can then optionally
add normal metrics, such as a <code class="literal">sum</code>, inside of that histogram.  Finally, the <code class="literal">moving_avg</code> is embedded inside the histogram.
The <code class="literal">buckets_path</code> parameter is then used to "point" at one of the sibling metrics inside of the histogram.</p><p>A moving average can also be calculated on the document count of each bucket, instead of a metric:</p><pre class="programlisting prettyprint lang-js">{
    "my_date_histo":{
        "date_histogram":{
            "field":"timestamp",
            "interval":"day",
            "min_doc_count": 0
        },
        "aggs":{
            "the_movavg":{
                "moving_avg":{ "buckets_path": "_count" } <a id="CO49-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            }
        }
    }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO49-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
By using <code class="literal">_count</code> instead of a metric name, we can calculate the moving average of document counts in the histogram
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_models"></a>Models<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/aggregations/reducer/movavg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">moving_avg</code> aggregation includes four different moving average "models".  The main difference is how the values in the
window are weighted.  As data-points become "older" in the window, they may be weighted differently.  This will
affect the final average for that window.</p><p>Models are specified using the <code class="literal">model</code> parameter.  Some models may have optional configurations which are specified inside
the <code class="literal">settings</code> parameter.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_simple"></a>Simple<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/aggregations/reducer/movavg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The <code class="literal">simple</code> model calculates the sum of all values in the window, then divides by the size of the window.  It is effectively
a simple arithmetic mean of the window.  The simple model does not perform any time-dependent weighting, which means
the values from a <code class="literal">simple</code> moving average tend to "lag" behind the real data.</p><pre class="programlisting prettyprint lang-js">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "model" : "simple"
        }
    }
}</pre><p>A <code class="literal">simple</code> model has no special settings to configure</p><p>The window size can change the behavior of the moving average.  For example, a small window (<code class="literal">"window": 10</code>) will closely
track the data and only smooth out small scale fluctuations:</p><div class="figure"><a id="movavg_10window"></a><p class="title"><strong>Figure 1. Moving average with window of size 10</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/reducers_movavg/movavg_10window.png" alt="images/reducers_movavg/movavg_10window.png" /></div></div></div><br class="figure-break" /><p>In contrast, a <code class="literal">simple</code> moving average with larger window (<code class="literal">"window": 100</code>) will smooth out all higher-frequency fluctuations,
leaving only low-frequency, long term trends.  It also tends to "lag" behind the actual data by a substantial amount:</p><div class="figure"><a id="movavg_100window"></a><p class="title"><strong>Figure 2. Moving average with window of size 100</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/reducers_movavg/movavg_100window.png" alt="images/reducers_movavg/movavg_100window.png" /></div></div></div><br class="figure-break" /></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_linear"></a>Linear<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/aggregations/reducer/movavg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">linear</code> model assigns a linear weighting to points in the series, such that "older" datapoints (e.g. those at
the beginning of the window) contribute a linearly less amount to the total average.  The linear weighting helps reduce
the "lag" behind the data’s mean, since older points have less influence.</p><pre class="programlisting prettyprint lang-js">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "model" : "linear"
        }
}</pre><p>A <code class="literal">linear</code> model has no special settings to configure</p><p>Like the <code class="literal">simple</code> model, window size can change the behavior of the moving average.  For example, a small window (<code class="literal">"window": 10</code>)
will closely track the data and only smooth out small scale fluctuations:</p><div class="figure"><a id="linear_10window"></a><p class="title"><strong>Figure 3. Linear moving average with window of size 10</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/reducers_movavg/linear_10window.png" alt="images/reducers_movavg/linear_10window.png" /></div></div></div><br class="figure-break" /><p>In contrast, a <code class="literal">linear</code> moving average with larger window (<code class="literal">"window": 100</code>) will smooth out all higher-frequency fluctuations,
leaving only low-frequency, long term trends.  It also tends to "lag" behind the actual data by a substantial amount,
although typically less than the <code class="literal">simple</code> model:</p><div class="figure"><a id="linear_100window"></a><p class="title"><strong>Figure 4. Linear moving average with window of size 100</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/reducers_movavg/linear_100window.png" alt="images/reducers_movavg/linear_100window.png" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_single_exponential"></a>Single Exponential<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/aggregations/reducer/movavg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">single_exp</code> model is similar to the <code class="literal">linear</code> model, except older data-points become exponentially less important,
rather than linearly less important.  The speed at which the importance decays can be controlled with an <code class="literal">alpha</code>
setting.  Small values make the weight decay slowly, which provides greater smoothing and takes into account a larger
portion of the window.  Larger valuers make the weight decay quickly, which reduces the impact of older values on the
moving average.  This tends to make the moving average track the data more closely but with less smoothing.</p><p>The default value of <code class="literal">alpha</code> is <code class="literal">0.5</code>, and the setting accepts any float from 0-1 inclusive.</p><pre class="programlisting prettyprint lang-js">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "model" : "single_exp",
            "settings" : {
                "alpha" : 0.5
            }
        }
}</pre><div class="figure"><a id="single_0.2alpha"></a><p class="title"><strong>Figure 5. Single Exponential moving average with window of size 10, alpha = 0.2</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/reducers_movavg/single_0.2alpha.png" alt="images/reducers_movavg/single_0.2alpha.png" /></div></div></div><br class="figure-break" /><div class="figure"><a id="single_0.7alpha"></a><p class="title"><strong>Figure 6. Single Exponential moving average with window of size 10, alpha = 0.7</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/reducers_movavg/single_0.7alpha.png" alt="images/reducers_movavg/single_0.7alpha.png" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_double_exponential"></a>Double Exponential<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/aggregations/reducer/movavg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">double_exp</code> model, sometimes called "Holt’s Linear Trend" model, incorporates a second exponential term which
tracks the data’s trend.  Single exponential does not perform well when the data has an underlying linear trend.  The
double exponential model calculates two values internally: a "level" and a "trend".</p><p>The level calculation is similar to <code class="literal">single_exp</code>, and is an exponentially weighted view of the data.  The difference is
that the previously smoothed value is used instead of the raw value, which allows it to stay close to the original series.
The trend calculation looks at the difference between the current and last value (e.g. the slope, or trend, of the
smoothed data).  The trend value is also exponentially weighted.</p><p>Values are produced by multiplying the level and trend components.</p><p>The default value of <code class="literal">alpha</code> and <code class="literal">beta</code> is <code class="literal">0.5</code>, and the settings accept any float from 0-1 inclusive.</p><pre class="programlisting prettyprint lang-js">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "model" : "double_exp",
            "settings" : {
                "alpha" : 0.5,
                "beta" : 0.5
            }
        }
}</pre><p>In practice, the <code class="literal">alpha</code> value behaves very similarly in <code class="literal">double_exp</code> as <code class="literal">single_exp</code>: small values produce more smoothing
and more lag, while larger values produce closer tracking and less lag.  The value of <code class="literal">beta</code> is often difficult
to see.  Small values emphasize long-term trends (such as a constant linear trend in the whole series), while larger
values emphasize short-term trends.  This will become more apparently when you are predicting values.</p><div class="figure"><a id="double_0.2beta"></a><p class="title"><strong>Figure 7. Double Exponential moving average with window of size 100, alpha = 0.5, beta = 0.2</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/reducers_movavg/double_0.2beta.png" alt="images/reducers_movavg/double_0.2beta.png" /></div></div></div><br class="figure-break" /><div class="figure"><a id="double_0.7beta"></a><p class="title"><strong>Figure 8. Double Exponential moving average with window of size 100, alpha = 0.5, beta = 0.7</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/reducers_movavg/double_0.7beta.png" alt="images/reducers_movavg/double_0.7beta.png" /></div></div></div><br class="figure-break" /></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-reducer-min-bucket-aggregation.html">
              « 
              Max Bucket Aggregation</a>
           
        </span><span class="next">
           
          <a href="_prediction.html">Prediction
               »
            </a></span></div>
<!-- end body -->

            </section>

            <div id="rtpcontainer"
        >
	<h3>Top Videos</h3>
	<ul class="lists">
		<li><a href="http://www.elastic.co/webinars/getting-started-with-elasticsearch/?elektra=docs">Getting Started</a></li>
		<li><a href="http://www.elastic.co/webinars/elasticsearch-performance-optimization-tale-two-tickets/?elektra=docs">Scaling</a></li>
		<li><a href="http://www.elastic.co/webinars/shield-securing-your-data-in-elasticsearch/?elektra=docs">Security</a></li>
	</ul>
</div>


	  	

  	<!-- Footer -->
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elasticsearch" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script src="/static/js/script.js"></script>
   	
   	
   	
   	<script type="application/ld+json">
	{
	  	"@context": "http://schema.org",
	  	"@type": "Organization",
	  	"name" : "Elastic",
	  	"url": "https://www.elastic.co/",
	  	"logo": "https://www.elastic.co/static/img/logo-elastic.png",
		"sameAs" : [ "https://www.facebook.com/elastic.co",
			"https://twitter.com/elastic",
			"https://plus.google.com/105178019064686397293",
			"https://www.youtube.com/user/elasticsearch",
			"https://www.linkedin.com/company/elasticsearch"
		],
	  	"potentialAction": {
	    	"@type": "SearchAction",
	    	"target": "https://www.elastic.co/search?q={query_string}",
	    	"query-input": "required name=query_string"
	  	}
	}
</script>	

            <script type="text/javascript">
  jQuery(function() {
    jQuery('#rtpcontainer').prependTo('#guide');
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + (10 + height) + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            </body>
        